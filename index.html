<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Links Preview Organizer2.0</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  
  <style>
    /* Estilos básicos do corpo da página */
    body {
      min-height: 100vh; /* Altura mínima de 100% da viewport */
      display: flex; /* Usa flexbox para centralizar conteúdo */
      justify-content: center; /* Centraliza horizontalmente */
      align-items: flex-start; /* Alinha ao topo verticalmente */
      font-family: 'Inter', sans-serif; /* Define a fonte principal */
      transition: background 0.8s ease-in-out; /* Transição suave para mudança de fundo (tema) */
      overflow-x: hidden; /* Evita rolagem horizontal indesejada */
      padding-top: 1rem; /* Espaçamento no topo */
    }

    /* Tema claro: gradiente de fundo azul/verde claro */
    body.light {
      background: linear-gradient(135deg, #e0f2f7, #c1e7f0, #9fd8e6);
    }

    /* Tema escuro: gradiente de fundo escuro */
    body.dark {
      background: linear-gradient(135deg, #1a2a3a, #0a1a2a, #050f1a);
    }

    /* Efeito de vidro (glass effect) aplicado a vários elementos */
    .glass-effect {
      background: rgba(255, 255, 255, 0.4); /* Fundo translúcido (40% opacidade) */
      backdrop-filter: blur(12px); /* Efeito de desfoque no que está por trás */
      border: 1px solid rgba(255, 255, 255, 0.5); /* Borda semi-transparente */
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); /* Sombra suave */
      border-radius: 16px; /* Bordas arredondadas */
      transition: all 0.4s ease-in-out; /* Transição para todas as propriedades em 0.4s */
      box-sizing: border-box; /* Inclui padding e borda no cálculo do tamanho */
    }

    /* Estilos do efeito de vidro no tema escuro */
    body.dark .glass-effect {
      background: rgba(0, 0, 0, 0.2); /* Fundo mais escuro */
      border: 1px solid rgba(255, 255, 255, 0.08); /* Borda mais sutil */
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4); /* Sombra mais pronunciada */
    }

    /* Efeito de hover para elementos com 'glass-effect' */
    .glass-effect:hover {
      transform: translateY(-3px); /* Leve levantamento ao passar o mouse */
      box-shadow: 0 15px 45px rgba(0, 0, 0, 0.15); /* Sombra maior ao passar o mouse */
    }

    /* Efeito de hover no tema escuro para 'glass-effect' */
    body.dark .glass-effect:hover {
      box-shadow: 0 15px 45px rgba(0, 0, 0, 0.6); /* Sombra ainda mais pronunciada */
    }

    /* Estilos para botões de menu (Settings, Manage Data) */
    .menu-button {
      transition: all 0.3s ease-in-out; /* Transição suave para interações */
    }

    /* Efeito de hover para botões de menu */
    .menu-button:hover {
      transform: scale(1.08); /* Aumento de escala leve */
      filter: brightness(1.1); /* Aumento de brilho leve */
    }

    /* Estilos para inputs de texto e selects */
    input, select {
      background: rgba(255, 255, 255, 0.6); /* Fundo translúcido (tema claro) */
      border: 1px solid rgba(255, 255, 255, 0.7); /* Borda semi-transparente (tema claro) */
      transition: all 0.3s ease-in-out; /* Transição suave */
      width: 100%; /* Ocupa a largura total do contêiner */
      height: 3rem; /* Altura fixa */
      padding: 0.75rem; /* Preenchimento interno */
      border-radius: 0.5rem; /* Bordas arredondadas */
      color: #333; /* Cor do texto (tema claro) */
      font-size: 0.875rem; /* Tamanho da fonte */
      box-sizing: border-box; /* Inclui padding e borda no cálculo do tamanho */
    }

    /* Estilos de inputs e selects no tema escuro */
    body.dark input, body.dark select {
      background: rgba(255, 255, 255, 0.05); /* Fundo mais escuro */
      border: 1px solid rgba(255, 255, 255, 0.1); /* Borda mais sutil */
      color: #e0e7ff; /* Cor do texto mais clara */
    }

    /* Estilos para opções de select (dropdown) */
    select option {
        background-color: #ffffff; /* Fundo branco (tema claro) */
        color: #333; /* Texto escuro (tema claro) */
    }

    /* Estilos para opções de select no tema escuro */
    body.dark select option {
        background-color: #2a2a2a; /* Fundo escuro */
        color: #e0e7ff; /* Texto claro */
    }

    /* Estilos de foco para inputs e selects */
    input:focus, select:focus {
      background: rgba(255, 255, 255, 0.7); /* Fundo mais opaco ao focar */
      border-color: #007bff; /* Borda azul ao focar */
      box-shadow: 0 0 15px rgba(0, 123, 255, 0.4); /* Sombra azul ao focar */
      outline: none; /* Remove o contorno padrão do navegador */
    }

    /* Estilos de foco no tema escuro para inputs e selects */
    body.dark input:focus, body.dark select:focus {
      background: rgba(255, 107, 107, 0.1); /* Fundo vermelho/transparente */
      border-color: #ff6b6b; /* Borda vermelha */
      box-shadow: 0 0 15px rgba(255, 107, 107, 0.6); /* Sombra vermelha */
    }

    /* Animação de fade-in para elementos que aparecem na tela */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); } /* Começa invisível e ligeiramente abaixo */
      to { opacity: 1; transform: translateY(0); } /* Termina visível e na posição original */
    }
    .animate-fade-in {
      animation: fadeIn 0.6s ease-out; /* Aplica a animação fadeIn */
    }

    /* Estilos da imagem de preview ao adicionar um item */
    .add-item-preview-img {
      max-width: 80px; /* Largura máxima */
      max-height: 80px; /* Altura máxima */
      object-fit: cover; /* Ajusta a imagem para preencher, cortando se necessário */
      border-radius: 8px; /* Bordas arredondadas */
    }

    /* Estilos da imagem de thumbnail dos itens salvos */
    .item-thumbnail-img {
      width: 100%; /* Ocupa a largura total do contêiner */
      height: 180px; /* Altura fixa */
      object-fit: cover; /* Ajusta a imagem para preencher, cortando se necessário */
      border-radius: 12px; /* Bordas arredondadas */
      margin-bottom: 8px; /* Espaçamento inferior */
    }

    /* Estilos para os itens individuais na lista de itens salvos */
    #items-list .glass-effect {
      display: flex; /* Usa flexbox */
      flex-direction: column; /* Itens empilhados verticalmente */
      align-items: center; /* Centraliza itens horizontalmente */
      text-align: center; /* Centraliza texto */
      padding: 0.75rem; /* Preenchimento interno */
      border-radius: 1rem; /* Bordas arredondadas */
      border: 2px solid transparent; /* Borda transparente (para ser alterada via JS com a cor da pasta) */
    }

    /* Estilos para o link/contêiner clicável dentro do item da lista */
    #items-list .glass-effect > a, #items-list .glass-effect > div[onclick] {
      display: flex; /* Usa flexbox */
      flex-direction: column; /* Conteúdo empilhado verticalmente */
      align-items: center; /* Centraliza horizontalmente */
      text-align: center; /* Centraliza texto */
      width: 100%; /* Ocupa a largura total */
      flex-grow: 1; /* Permite que cresça para preencher espaço */
      text-decoration: none; /* Remove sublinhado de links */
      color: inherit; /* Herda a cor do texto do pai */
    }

    /* Estilos do título do item na lista */
    #items-list .glass-effect .item-title {
      font-size: 1.15rem; /* Tamanho da fonte */
      line-height: 1.3; /* Altura da linha */
      margin-top: 0.5rem; /* Espaçamento superior */
      font-weight: 600; /* Peso da fonte */
    }

    /* Cor do título do item no tema claro */
    body.light #items-list .glass-effect .item-title {
      color: #000000; /* Preto para alto contraste */
    }

    /* Cor do título do item no tema escuro */
    body.dark #items-list .glass-effect .item-title {
      color: rgb(21, 132, 63); /* Verde mais claro */
    }

    /* Descrição do item (oculta na lista principal) */
    #items-list .glass-effect .item-description {
      display: none; /* Oculta a descrição */
    }

    /* Estilos da URL curta do item na lista */
    #items-list .glass-effect .item-url-short {
      font-size: 0.75rem; /* Tamanho da fonte menor */
      opacity: 0.8; /* Levemente transparente */
      margin-top: 0.25rem; /* Espaçamento superior */
    }

    /* Cor da URL curta no tema claro */
    body.light #items-list .glass-effect .item-url-short {
      color: rgb(50, 50, 50); /* Cinza escuro */
    }

    /* Cor da URL curta no tema escuro */
    body.dark #items-list .glass-effect .item-url-short {
      color: #b9b9b9; /* Cinza claro */
    }

    /* Estilos da data de adição do item na lista */
    #items-list .glass-effect .item-added-date {
      font-size: 0.7rem; /* Tamanho da fonte menor */
      color: #718096; /* Cinza */
      opacity: 0.9; /* Quase opaco */
      margin-top: 0.5rem; /* Espaçamento superior */
    }

    /* Cor da data de adição no tema escuro */
    body.dark #items-list .glass-effect .item-added-date {
      color: #718096; /* Cinza */
    }

    /* Utilidades para truncar texto em 2 linhas */
    .truncate-lines-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2; /* Limita a 2 linhas */
        -webkit-box-orient: vertical;
        overflow: hidden; /* Oculta o conteúdo extra */
        text-overflow: ellipsis; /* Adiciona "..." no final */
    }

    /* Utilidades para truncar texto em 3 linhas */
    .truncate-lines-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3; /* Limita a 3 linhas */
        -webkit-box-orient: vertical;
        overflow: hidden; /* Oculta o conteúdo extra */
        text-overflow: ellipsis; /* Adiciona "..." no final */
    }

    /* Estilos para o painel de configurações */
    #settings-panel {
      max-height: 70vh; /* Altura máxima para rolagem */
      overflow-y: auto; /* Adiciona barra de rolagem vertical se o conteúdo exceder */
    }

    /* Estilos para o overlay de modais (fundo escuro por trás do modal) */
    .modal-overlay {
      position: fixed; /* Fixa na viewport */
      top: 0;
      left: 0;
      width: 100%; /* Largura total */
      height: 100%; /* Altura total */
      background: rgba(0, 0, 0, 0.7); /* Fundo preto translúcido */
      display: flex; /* Usa flexbox para centralizar o conteúdo do modal */
      justify-content: center; /* Centraliza horizontalmente */
      align-items: center; /* Centraliza verticalmente */
      z-index: 1000; /* Fica acima de outros elementos */
      animation: fadeIn 0.3s ease-out; /* Animação de fade-in ao aparecer */
    }

    /* Estilos para o conteúdo do modal */
    .modal-content {
      background: #fff; /* Fundo branco (tema claro) */
      padding: 25px; /* Preenchimento interno */
      border-radius: 15px; /* Bordas arredondadas */
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3); /* Sombra suave */
      text-align: center; /* Centraliza texto */
      color: #333; /* Cor do texto (tema claro) */
      max-width: 400px; /* Largura máxima */
      width: 90%; /* Ocupa 90% da largura do contêiner */
      position: relative; /* Para posicionar o botão de fechar */
      animation: scaleIn 0.3s ease-out; /* Animação de escala ao aparecer */
    }

    /* Estilos do conteúdo do modal no tema escuro */
    body.dark .modal-content {
      background: #2a2a2a; /* Fundo escuro */
      color: #e0e7ff; /* Texto claro */
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.6); /* Sombra mais escura */
    }

    /* Animação de escala para modais */
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; } /* Começa menor e invisível */
      to { transform: scale(1); opacity: 1; } /* Termina no tamanho original e visível */
    }

    /* Estilos para o botão de fechar do modal */
    .modal-close-btn {
      position: absolute; /* Posiciona absolutamente */
      top: 10px; /* 10px do topo */
      right: 10px; /* 10px da direita */
      background: none; /* Sem fundo */
      border: none; /* Sem borda */
      font-size: 1.5rem; /* Tamanho do ícone "X" */
      cursor: pointer; /* Cursor de ponteiro */
      color: #888; /* Cor cinza */
      transition: color 0.2s ease-in-out; /* Transição de cor */
    }

    /* Efeito de hover no botão de fechar do modal */
    .modal-close-btn:hover {
      color: #333; /* Cor mais escura no hover */
    }

    /* Estilos do botão de fechar do modal no tema escuro */
    body.dark .modal-close-btn {
      color: #bbb; /* Cor mais clara */
    }
    body.dark .modal-close-btn:hover {
      color: #fff; /* Cor branca no hover */
    }

    /* Grupo de input dentro do modal */
    .modal-input-group {
        margin-bottom: 15px; /* Espaço entre grupos de input */
        text-align: left; /* Alinha texto à esquerda */
    }

    /* Label do grupo de input do modal */
    .modal-input-group label {
      color: #333; /* Cor do texto (tema claro) */
      display: block; /* Garante que o label ocupe sua própria linha */
      margin-bottom: 5px; /* Espaço entre label e input */
      font-weight: 600; /* Peso da fonte */
    }

    /* Label do grupo de input do modal no tema escuro */
    body.dark .modal-input-group label {
      color: #e0e7ff; /* Cor do texto mais clara */
    }

    /* Inputs e selects dentro do modal */
    .modal-input-group input, .modal-input-group select {
      background: #f0f0f0; /* Fundo cinza claro */
      border: 1px solid #ddd; /* Borda cinza */
      color: #333; /* Cor do texto */
      width: 100%; /* Ocupa a largura total */
      padding: 8px 12px; /* Preenchimento interno */
      border-radius: 5px; /* Bordas arredondadas */
    }

    /* Inputs e selects dentro do modal no tema escuro */
    body.dark .modal-input-group input, body.dark .modal-input-group select {
      background: rgba(255, 255, 255, 0.05); /* Fundo mais escuro */
      border: 1px solid rgba(255, 255, 255, 0.1); /* Borda mais sutil */
      color: #e0e7ff; /* Texto mais claro */
    }

    /* Ações do modal (botões) */
    .modal-actions {
      display: flex; /* Usa flexbox */
      justify-content: center; /* Centraliza botões */
      gap: 15px; /* Espaçamento entre botões */
      margin-top: 20px; /* Espaçamento superior */
    }

    /* Estilo base para botões de modal */
    .modal-btn {
      padding: 10px 20px; /* Preenchimento interno */
      border-radius: 8px; /* Bordas arredondadas */
      font-weight: 600; /* Peso da fonte */
      cursor: pointer; /* Cursor de ponteiro */
      border: none; /* Sem borda */
      transition: all 0.2s ease-in-out; /* Transição suave */
    }

    /* Botão de confirmação no modal */
    .modal-btn.confirm {
      background-color: #007bff; /* Azul brilhante */
      color: white; /* Texto branco */
    }
    .modal-btn.confirm:hover {
      background-color: #0056b3; /* Azul mais escuro no hover */
      transform: translateY(-1px); /* Leve levantamento */
    }

    /* Botão de cancelar no modal */
    .modal-btn.cancel {
      background-color: #cccccc; /* Cinza claro */
      color: #333; /* Texto escuro */
    }
    .modal-btn.cancel:hover {
      background-color: #b0b0b0; /* Cinza mais escuro no hover */
      transform: translateY(-1px); /* Leve levantamento */
    }

    /* Botão de excluir pasta no modal */
    .modal-btn.delete-folder {
      background-color: #dc3545; /* Vermelho */
      color: white; /* Texto branco */
    }
    .modal-btn.delete-folder:hover {
      background-color: #c82333; /* Vermelho mais escuro no hover */
    }

    /* Botões de ação para pastas (editar) */
    .folder-action-btn {
      padding: 4px 8px; /* Preenchimento interno */
      border-radius: 6px; /* Bordas arredondadas */
      font-size: 0.75rem; /* Tamanho da fonte menor */
      font-weight: 500; /* Peso da fonte */
      margin-left: 5px; /* Espaçamento à esquerda */
      transition: all 0.2s ease-in-out; /* Transição suave */
    }
    .folder-action-btn.edit {
      background-color: #007bff; /* Azul */
      color: white; /* Texto branco */
    }
    .folder-action-btn.edit:hover {
      background-color: #0056b3; /* Azul mais escuro no hover */
    }

    /* Botão de editar item */
    .edit-item-btn {
        background-color: #28a745; /* Verde */
        color: white; /* Texto branco */
        padding: 4px 8px; /* Preenchimento interno */
        border-radius: 6px; /* Bordas arredondadas */
        font-size: 0.75rem; /* Tamanho da fonte menor */
        font-weight: 500; /* Peso da fonte */
        margin-left: 5px; /* Espaçamento à esquerda */
        transition: all 0.2s ease-in-out; /* Transição suave */
    }
    .edit-item-btn:hover {
        background-color: #218838; /* Verde mais escuro no hover */
    }

    /* Estilos para itens de tag na lista de tags */
    .tag-item {
        display: flex; /* Usa flexbox */
        justify-content: space-between; /* Espaçamento entre os elementos */
        align-items: center; /* Alinha verticalmente ao centro */
        padding: 8px 12px; /* Preenchimento interno */
        background: rgba(255, 255, 255, 0.4); /* Fundo translúcido (tema claro) */
        border-radius: 8px; /* Bordas arredondadas */
        margin-bottom: 8px; /* Espaçamento inferior */
        color: #333; /* Cor do texto (tema claro) */
    }

    /* Estilos para itens de tag no tema escuro */
    body.dark .tag-item {
        background: rgba(255, 255, 255, 0.05); /* Fundo mais escuro */
        color: white; /* Texto branco */
    }

    /* Botões dentro de itens de tag */
    .tag-item-buttons button {
        padding: 4px 8px; /* Preenchimento interno */
        border-radius: 6px; /* Bordas arredondadas */
        font-size: 0.75rem; /* Tamanho da fonte menor */
        font-weight: 500; /* Peso da fonte */
        margin-left: 8px; /* Espaçamento à esquerda */
        transition: all 0.2s ease-in-out; /* Transição suave */
    }
    .tag-item-buttons .edit {
        background-color: #007bff; /* Azul */
        color: white; /* Texto branco */
    }
    .tag-item-buttons .edit:hover {
        background-color: #0056b3; /* Azul mais escuro no hover */
    }
    .tag-item-buttons .delete {
        background-color: #dc3545; /* Vermelho */
        color: white; /* Texto branco */
    }
    .tag-item-buttons .delete:hover {
        background-color: #c82333; /* Vermelho mais escuro no hover */
    }

    /* Botão para limpar input */
    .clear-input-btn {
        position: absolute; /* Posiciona absolutamente */
        right: 10px; /* 10px da direita */
        top: 50%; /* Centraliza verticalmente */
        transform: translateY(-50%); /* Ajusta para centralização exata */
        background: none; /* Sem fundo */
        border: none; /* Sem borda */
        color: #888; /* Cor cinza */
        cursor: pointer; /* Cursor de ponteiro */
        font-size: 1rem; /* Tamanho da fonte */
        padding: 5px; /* Preenchimento interno */
        line-height: 1; /* Altura da linha */
        transition: color 0.2s ease-in-out; /* Transição de color */
    }
    .clear-input-btn:hover {
        color: #333; /* Cor mais escura no hover */
    }
    body.dark .clear-input-btn {
        color: #bbb; /* Cor mais clara */
    }
    body.dark .clear-input-btn:hover {
        color: #fff; /* Cor branca no hover */
    }
    .input-with-clear {
        position: relative; /* Permite posicionamento absoluto do botão de limpar */
    }
    .hidden {
      display: none; /* Utilidade para ocultar elementos */
    }

    /* Mensagem de carregamento */
    .loading-message {
        position: fixed; /* Fixo na tela */
        top: 50%; /* Centraliza verticalmente */
        left: 50%; /* Centraliza horizontalmente */
        transform: translate(-50%, -50%); /* Ajusta para centralização exata */
        background: rgba(0, 0, 0, 0.8); /* Fundo preto translúcido */
        color: white; /* Texto branco */
        padding: 15px 30px; /* Preenchimento */
        border-radius: 10px; /* Bordas arredondadas */
        z-index: 1001; /* Fica acima de outros elementos */
        font-size: 1.2rem; /* Tamanho da fonte */
        display: none; /* Inicia oculto */
    }

    /* Estilo para ícones SVG em selects e buttons */
    .icon-svg {
        height: 1em; /* Altura proporcional ao texto */
        width: 1em; /* Largura proporcional ao texto */
        vertical-align: middle; /* Alinha verticalmente com o texto */
        margin-right: 0.25em; /* Espaçamento à direita */
        filter: invert(0); /* Padrão: sem inversão de cor (tema claro) */
    }
    /* Inverte a cor do SVG no tema escuro */
    body.dark .icon-svg {
        filter: invert(1); /* Inverte a cor (branco para preto, etc.) */
    }

    /* Estilos para o sistema de estrelas (avaliação) */
    .star-rating {
        display: inline-flex; /* Estrelas em linha */
        direction: rtl; /* Direção do texto da direita para a esquerda (para alinhar estrelas) */
        unicode-bidi: isolate; /* Controla o algoritmo bidirecional */
        gap: 2px; /* Espaçamento entre estrelas */
    }
    .star-rating input[type="radio"] {
        display: none; /* Oculta os botões de rádio nativos */
    }
    .star-rating label {
        color: #ccc; /* Cor da estrela vazia */
        font-size: 1.5rem; /* Tamanho da estrela */
        cursor: pointer; /* Cursor de ponteiro */
        transition: color 0.2s; /* Transição de cor */
    }
    .star-rating label:hover,
    .star-rating label:hover ~ label,
    .star-rating input[type="radio"]:checked ~ label {
        color: #ffb700; /* Cor da estrela preenchida (amarelo/laranja) */
    }

    /* Estilo para exibição das estrelas (não clicável) */
    .display-rating .star {
        font-size: 1.2rem; /* Tamanho menor para exibição */
        color: #ffb700; /* Cor da estrela preenchida */
        margin: 0 1px; /* Margem horizontal */
    }
    .display-rating .star-empty {
        font-size: 1.2rem; /* Tamanho menor para exibição */
        color: #ccc; /* Cor da estrela vazia */
        margin: 0 1px; /* Margem horizontal */
    }

    /* Ações do item na parte inferior (botões de copiar, editar, excluir) */
    .item-actions-bottom {
      display: flex; /* Usa flexbox */
      flex-wrap: wrap; /* Permite que os botões quebrem a linha */
      justify-content: center; /* Centraliza botões */
      align-items: center; /* Alinha verticalmente ao centro */
      gap: 0.5rem; /* Espaçamento entre os botões */
    }

    /* Estilos para grupos de checkbox no modal de importação */
    .modal-checkbox-group {
        display: flex; /* Usa flexbox */
        flex-direction: column; /* Checkboxes empilhados verticalmente */
        align-items: flex-start; /* Alinha checkboxes à esquerda */
        margin-top: 15px; /* Espaçamento superior */
        gap: 10px; /* Espaçamento entre checkboxes */
    }
    .modal-checkbox-group label {
        display: flex; /* Usa flexbox para alinhar checkbox e texto */
        align-items: center; /* Alinha verticalmente ao centro */
        cursor: pointer; /* Cursor de ponteiro */
        font-size: 1rem; /* Tamanho da fonte */
        color: #333; /* Cor do texto (tema claro) */
    }
    body.dark .modal-checkbox-group label {
        color: #e0e7ff; /* Cor do texto (tema escuro) */
    }
    .modal-checkbox-group input[type="checkbox"] {
        margin-right: 10px; /* Espaçamento à direita do checkbox */
        transform: scale(1.2); /* Aumenta o tamanho do checkbox */
    }

    /* Estilos para os botões das abas */
    .tab-buttons {
      display: flex; /* Usa flexbox */
      justify-content: center; /* Centraliza os botões das abas */
      margin-bottom: 1rem; /* Espaçamento inferior */
      gap: 0.5rem; /* Espaçamento entre os botões */
      flex-wrap: wrap; /* Permite que os botões quebrem a linha em telas menores */
    }

    /* Estilo base para cada botão de aba */
    .tab-button {
      padding: 0.75rem 1.5rem; /* Preenchimento interno */
      background-color: rgba(255, 255, 255, 0.2); /* Fundo translúcido (tema claro) */
      backdrop-filter: blur(8px); /* Desfoque de fundo */
      border: 1px solid rgba(255, 255, 255, 0.3); /* Borda */
      border-radius: 12px; /* Bordas arredondadas */
      color: #333; /* Cor do texto (tema claro) */
      font-weight: 600; /* Peso da fonte */
      cursor: pointer; /* Cursor de ponteiro */
      transition: all 0.3s ease; /* Transição suave para interações */
    }

    /* Estilo dos botões de aba no tema escuro */
    body.dark .tab-button {
      background-color: rgba(0, 0, 0, 0.15); /* Fundo mais escuro */
      border: 1px solid rgba(255, 255, 255, 0.05); /* Borda mais sutil */
      color: white; /* Texto branco */
    }

    /* Efeito de hover nos botões de aba */
    .tab-button:hover {
      background-color: rgba(255, 255, 255, 0.4); /* Fundo mais opaco */
      border-color: rgba(255, 255, 255, 0.5); /* Borda mais visível */
      transform: translateY(-2px); /* Leve levantamento */
    }

    /* Efeito de hover nos botões de aba no tema escuro */
    body.dark .tab-button:hover {
      background-color: rgba(0, 0, 0, 0.3); /* Fundo mais escuro */
      border-color: rgba(255, 255, 255, 0.1); /* Borda mais visível */
    }

    /* Estilo para a aba ativa */
    .tab-button.active {
      background: linear-gradient(135deg, #007bff, #0056b3); /* Gradiente azul forte */
      color: white; /* Texto branco */
      border-color: #007bff; /* Borda azul */
      box-shadow: 0 4px 10px rgba(0, 123, 255, 0.3); /* Sombra azul */
    }

    /* Estilo para a aba ativa no tema escuro */
    body.dark .tab-button.active {
      background: linear-gradient(135deg, #4ecdc4, #45b7d1); /* Gradiente ciano/azul */
      border-color: #4ecdc4; /* Borda ciano */
      box-shadow: 0 4px 10px rgba(78, 205, 196, 0.3); /* Sombra ciano */
    }

    /* Conteúdo das abas (inicialmente oculto) */
    .tab-content {
      display: none; /* Oculta todo o conteúdo das abas por padrão */
    }

    /* Conteúdo da aba ativa (visível) */
    .tab-content.active {
      display: block; /* Torna o conteúdo da aba ativa visível */
    }

    /* Estilos específicos para o layout do dashboard */
    .dashboard-grid {
        display: grid; /* Usa grid layout */
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* Colunas responsivas */
        gap: 1rem; /* Espaçamento entre os itens da grid */
        margin-top: 1rem; /* Espaçamento superior */
    }
    .dashboard-card {
        background: rgba(255, 255, 255, 0.6); /* Fundo translúcido (tema claro) */
        padding: 1rem; /* Preenchimento */
        border-radius: 8px; /* Bordas arredondadas */
        border: 1px solid rgba(255, 255, 255, 0.7); /* Borda */
        box-shadow: 0 4px 10px rgba(0,0,0,0.05); /* Sombra */
        color: #333; /* Cor do texto (tema claro) */
    }
    body.dark .dashboard-card {
        background: rgba(0, 0, 0, 0.2); /* Fundo mais escuro */
        border: 1px solid rgba(255, 255, 255, 0.08); /* Borda mais sutil */
        color: #e0e7ff; /* Cor do texto (tema escuro) */
    }
    .dashboard-card h3 {
        font-weight: 600; /* Peso da fonte */
        margin-bottom: 0.5rem; /* Espaçamento inferior */
        color: #007bff; /* Cor do título (tema claro) */
    }
    body.dark .dashboard-card h3 {
        color: #4ecdc4; /* Cor do título (tema escuro) */
    }
    .dashboard-card p {
        font-size: 0.9rem; /* Tamanho da fonte */
    }
    .dashboard-list {
        list-style-type: none; /* Remove marcadores de lista */
        padding: 0; /* Remove preenchimento da lista */
    }
    .dashboard-list li {
        margin-bottom: 0.25rem; /* Espaçamento inferior para cada item da lista */
        font-size: 0.9rem; /* Tamanho da fonte */
        display: flex; /* Usa flexbox */
        justify-content: space-between; /* Espaço entre os elementos (nome e valor) */
        align-items: center; /* Alinha verticalmente ao centro */
        flex-wrap: wrap; /* Permite que o conteúdo quebre a linha */
        gap: 0.5rem; /* Espaçamento entre elementos em linha */
    }
    .dashboard-list li span:first-child {
        font-weight: 500; /* Peso da fonte para o primeiro span (nome) */
    }
    /* Estilos específicos para listas de avaliação no dashboard */
    .dashboard-list.ratings li span:first-child {
        display: flex; /* Usa flexbox para estrelas */
        align-items: center; /* Alinha estrelas verticalmente */
        gap: 2px; /* Espaçamento entre estrelas */
    }
    /* Linha de informações do item no dashboard (thumbnail + título) */
    .dashboard-list .item-info-row {
        display: flex; /* Usa flexbox */
        align-items: center; /* Alinha verticalmente ao centro */
        gap: 0.5rem; /* Espaçamento entre thumbnail e título */
        flex-grow: 1; /* Permite que cresça */
        min-width: 0; /* Permite que o conteúdo encolha para caber */
    }
    /* Thumbnail dos itens no dashboard */
    .dashboard-list .item-thumbnail {
        width: 40px; /* Largura fixa */
        height: 40px; /* Altura fixa */
        object-fit: cover; /* Ajusta a imagem */
        border-radius: 4px; /* Bordas arredondadas */
        flex-shrink: 0; /* Impede que a thumbnail encolha */
    }
    /* Botão "Copiar ID" no dashboard */
    .dashboard-list .copy-id-btn {
        padding: 4px 8px; /* Preenchimento */
        border-radius: 6px; /* Bordas arredondadas */
        font-size: 0.7rem; /* Tamanho da fonte */
        background-color: #28a745; /* Verde */
        color: white; /* Texto branco */
        transition: background-color 0.2s; /* Transição de cor */
        flex-shrink: 0; /* Impede que o botão encolha */
        cursor: pointer; /* Cursor de ponteiro */
    }
    .dashboard-list .copy-id-btn:hover {
        background-color: #218838; /* Verde mais escuro no hover */
    }

    /* Estilos do modal do reprodutor de vídeo */
    #video-player-modal .modal-content {
        max-width: 90%; /* Largura máxima */
        max-height: 90%; /* Altura máxima */
        width: 800px; /* Largura padrão para vídeos */
        height: auto; /* Altura automática para manter a proporção */
        background: #000; /* Fundo preto */
        padding: 0; /* Sem preenchimento */
        overflow: hidden; /* Oculta conteúdo extra */
        color: white; /* Cor do texto (se houver) */
        display: flex; /* Usa flexbox */
        flex-direction: column; /* Conteúdo empilhado verticalmente */
        justify-content: center; /* Centraliza verticalmente */
        align-items: center; /* Centraliza horizontalmente */
        aspect-ratio: 16/9; /* Proporção de vídeo padrão 16:9 */
    }

    /* Botão de fechar no modal do reprodutor de vídeo */
    #video-player-modal .modal-close-btn {
        color: white; /* Cor branca */
        top: 5px; /* 5px do topo */
        right: 5px; /* 5px da direita */
        z-index: 1001; /* Acima do vídeo */
        background: rgba(0,0,0,0.5); /* Fundo translúcido */
        border-radius: 50%; /* Circular */
        width: 30px; /* Largura */
        height: 30px; /* Altura */
        display: flex; /* Usa flexbox para centralizar "X" */
        justify-content: center; /* Centraliza "X" horizontalmente */
        align-items: center; /* Centraliza "X" verticalmente */
        font-size: 1.2rem; /* Tamanho da fonte do "X" */
    }

    /* Efeito de hover no botão de fechar do reprodutor de vídeo */
    #video-player-modal .modal-close-btn:hover {
        color: #eee; /* Cor mais clara */
        background: rgba(0,0,0,0.8); /* Fundo mais escuro */
    }

    /* Iframe dentro do contêiner do reprodutor de vídeo */
    #video-player-modal #video-player-iframe-container iframe {
        width: 100%; /* Largura total */
        height: 100%; /* Altura total */
        border: none; /* Sem borda */
    }
  </style>
</head>
<body class="light">
  <div class="w-full max-w-4xl mx-auto p-2 sm:p-4">
    <div class="flex flex-col sm:flex-row justify-between items-center mb-4 sm:mb-6 animate-fade-in">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 tracking-tight mb-2 sm:mb-0" data-i18n="appTitle">Liquid Glass Organizer</h1>
      <div class="flex flex-wrap gap-2 sm:gap-4">
        <button id="settings-btn" class="menu-button px-3 sm:px-4 py-1 sm:py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-white glass-effect font-semibold" data-i18n="settingsBtn">
          Settings
        </button>
        <button id="manage-data-btn" class="menu-button px-3 sm:px-4 py-1 sm:py-2 bg-gradient-to-r from-blue-600 to-teal-600 rounded-lg text-white glass-effect font-semibold" data-i18n="manageDataBtn">
          Manage Data
        </button>
      </div>
    </div>

    <div id="settings-panel" class="glass-effect rounded-lg p-2 sm:p-4 mb-4 sm:mb-6 animate-fade-in hidden w-full">
      <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4" data-i18n="settingsTitle">Settings</h2>
      <div class="flex flex-col sm:flex-row gap-2 sm:gap-4">
        <button id="toggle-theme-btn" class="px-3 sm:px-4 py-1 sm:py-2 bg-gradient-to-r from-green-600 to-lime-600 rounded-lg text-white font-semibold hover:from-green-700 hover:to-lime-700">
          Toggle Dark Theme
        </button>
        <button id="clear-items-btn" class="px-3 sm:px-4 py-1 sm:py-2 bg-gradient-to-r from-red-600 to-orange-600 rounded-lg text-white font-semibold hover:from-red-700 hover:to-orange-700" data-i18n="clearAllItemsBtn">
          Clear All Items
        </button>
      </div>
      <div class="input-group mt-4">
        <label for="language-select" class="text-gray-800" data-i18n="languageLabel">Language:</label>
        <select id="language-select" class="flex-1">
          <option value="pt-BR">Português (Brasil)</option>
          <option value="en">English</option>
          <option value="es">Español</option>
        </select>
      </div>
      <div class="mt-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-2" data-i18n="manageTagsTitle">Manage Tags</h3>
        <div class="flex flex-col sm:flex-row gap-2 mb-4 input-with-clear">
          <input type="text" id="new-tag-input" placeholder="New tag name" class="flex-1" data-i18n-placeholder="newTagPlaceholder">
          <button class="clear-input-btn" data-target-input="new-tag-input" data-i18n="clearBtn" title="Clear input">✕</button>
          <button id="add-tag-btn" class="px-3 py-1 bg-gradient-to-r from-green-500 to-green-700 rounded-lg text-white font-semibold hover:from-green-600 hover:to-green-800" data-i18n="addTagBtn">Add Tag</button>
        </div>
        <div id="tags-list" class="flex flex-wrap gap-2">
          </div>
      </div>
    </div>

    <div class="tab-buttons">
        <button class="tab-button active" data-tab="dashboard" data-i18n="dashboardTab">Dashboard</button>
        <button class="tab-button" data-tab="create-save" data-i18n="createSaveTab">Criar/Salvar Links</button>
        <button class="tab-button" data-tab="folders-items" data-i18n="foldersItemsTab">Pastas & Itens Salvos</button>
    </div>

    <div id="dashboard-tab" class="tab-content active glass-effect rounded-lg p-2 sm:p-4 mb-4 sm:mb-6 animate-fade-in">
        <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4" data-i18n="dashboardTitle">Dashboard</h2>
        <p class="text-gray-600 mb-4" data-i18n="dashboardContent">Bem-vindo ao seu painel! Aqui você encontrará um resumo de seus dados:</p>
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h3 data-i18n="totalItems">Total de Itens</h3>
                <p id="dashboard-total-items" class="text-2xl font-bold"></p>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="itemsByType">Itens por Tipo</h3>
                <ul id="dashboard-items-by-type" class="dashboard-list"></ul>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="totalFolders">Total de Pastas</h3>
                <p id="dashboard-total-folders" class="text-2xl font-bold"></p>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="itemsByFolder">Itens por Pasta</h3>
                <ul id="dashboard-items-by-folder" class="dashboard-list"></ul>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="totalTags">Total de Tags</h3>
                <p id="dashboard-total-tags" class="text-2xl font-bold"></p>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="topTags">Tags Mais Usadas</h3>
                <ul id="dashboard-top-tags" class="dashboard-list"></ul>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="itemsByRating">Itens por Avaliação</h3>
                <ul id="dashboard-items-by-rating" class="dashboard-list ratings"></ul>
            </div>
            <div class="dashboard-card">
                <h3 data-i18n="systemInfo">Informações do Sistema</h3>
                <p><span data-i18n="currentTheme">Tema Atual:</span> <span id="dashboard-current-theme"></span></p>
                <p><span data-i18n="currentLanguage">Idioma Atual:</span> <span id="dashboard-current-language"></span></p>
            </div>
            <div class="dashboard-card col-span-full">
                <h3 data-i18n="lastAccessedItemsTitle">Últimos Acessos (Vídeos)</h3>
                <ul id="dashboard-last-accessed-items" class="dashboard-list">
                    </ul>
            </div>
            <div class="dashboard-card col-span-full">
                <h3 data-i18n="mostAccessedItemsTitle">Vídeos Mais Acessados</h3>
                <ul id="dashboard-most-accessed-videos" class="dashboard-list">
                    </ul>
            </div>
        </div>
    </div>

    <div id="create-save-tab" class="tab-content">
        <div class="glass-effect rounded-lg p-2 sm:p-4 mb-4 sm:mb-6 animate-fade-in">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4" data-i18n="addNewItemTitle">Add New Item</h2>
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-4">
                <div class="flex-1 input-with-clear">
                    <input
                        id="item-url"
                        type="text"
                        placeholder="Enter or paste URL (e.g., video, photo, website)"
                        class="flex-1"
                        data-i18n-placeholder="itemUrlPlaceholder"
                    />
                    <button class="clear-input-btn" data-target-input="item-url" data-i18n="clearBtn" title="Clear input">✕</button>
                </div>
                <div class="flex-1 input-with-clear">
                    <input
                        id="item-tags"
                        type="text"
                        placeholder="Tags (e.g., inspiration, work, separated by commas)"
                        list="saved-tags-datalist"
                        class="flex-1"
                        data-i18n-placeholder="itemTagsPlaceholder"
                    />
                    <button class="clear-input-btn" data-target-input="item-tags" data-i18n="clearBtn" title="Clear input">✕</button>
                </div>
                <datalist id="saved-tags-datalist"></datalist>
                <button id="paste-link-btn" class="px-2 sm:px-3 py-1 sm:py-2 bg-gradient-to-r from-yellow-600 to-orange-600 rounded-lg text-white font-semibold hover:from-yellow-700 hover:to-orange-700" data-i18n="pasteLinkBtn">
                    Paste Link
                </button>
                <select id="item-type" class="flex-1" data-i18n="itemTypeSelect">
                    <option value="link" data-i18n="optionLink">Link</option>
                    <option value="video" data-i18n="optionVideo">Video</option>
                    <option value="photo" data-i18n="optionPhoto">Photo</option>
                </select>
                <select id="item-folder" class="flex-1">
                </select>
                <button id="add-item-btn" class="px-2 sm:px-3 py-1 sm:py-2 bg-gradient-to-r from-pink-600 to-purple-600 rounded-lg text-white font-semibold hover:from-pink-700 hover:to-purple-700" data-i18n="addItemBtn">
                    Add Item
                </button>
            </div>
            <div id="preview-container" class="mt-2 sm:mt-4 p-2 bg-white/40 rounded-lg hidden">
                <div class="flex items-start gap-2">
                    <img id="preview-image" src="" alt="Preview" class="add-item-preview-img">
                    <div>
                        <a id="preview-title" class="font-semibold text-gray-800 truncate hover:underline"></a>
                        <p id="preview-description" class="text-sm text-gray-600 truncate"></p>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-effect rounded-lg p-2 sm:p-4 mb-4 sm:mb-6 animate-fade-in">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4" data-i18n="createNewFolderTitle">Create New Folder</h2>
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-4">
                <div class="flex-1 input-with-clear">
                    <input
                        id="new-folder"
                        type="text"
                        placeholder="New folder name"
                        data-i18n-placeholder="newFolderNamePlaceholder"
                    />
                    <button class="clear-input-btn" data-target-input="new-folder" data-i18n="clearBtn" title="Clear input">✕</button>
                </div>
                <select id="folder-color" class="flex-1">
                    <option value="bg-blue-500" data-i18n="colorBlue">Blue</option>
                    <option value="bg-green-500" data-i18n="colorGreen">Green</option>
                    <option value="bg-red-500" data-i18n="colorRed">Red</option>
                    <option value="bg-purple-500" data-i18n="colorPurple">Purple</option>
                    <option value="bg-yellow-500" data-i18n="colorYellow">Yellow</option>
                    <option value="bg-black" data-i18n="colorBlack">Black</option>
                    <option value="bg-teal-600" data-i18n="colorTeal">Teal</option>
                    <option value="bg-pink-600" data-i18n="colorPink">Pink</option>
                </select>
                <select id="folder-icon" class="flex-1">
                    <option value="svg/tiktok.svg" data-i18n="iconTikTok">TikTok</option>
                    <option value="svg/kwai.svg" data-i18n="iconKwai">Kwai</option>
                    <option value="svg/facebook.svg" data-i18n="iconFacebook">Facebook</option>
                    <option value="svg/instagram.svg" data-i18n="iconInstagram">Instagram</option>
                    <option value="svg/youtube.svg" data-i18n="iconYouTube">YouTube</option>
                    <option value="svg/dailymotion.svg" data-i18n="iconDailymotion">Dailymotion</option>
                    <option value="svg/folder.svg" data-i18n="iconFolder">Folder</option>
                    <option value="svg/link.svg" data-i18n="iconLink">Outro Link</option>
                </select>
                <button id="add-folder-btn" class="px-2 sm:px-3 py-1 sm:py-2 bg-gradient-to-r from-blue-600 to-teal-600 rounded-lg text-white font-semibold hover:from-blue-700 hover:to-teal-700" data-i18n="addFolderBtn">
                    Add Folder
                </button>
            </div>
        </div>
    </div>

    <div id="folders-items-tab" class="tab-content">
        <div class="glass-effect rounded-lg p-2 sm:p-4 mb-4 sm:mb-6 animate-fade-in">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4 flex justify-between items-center">
                <span data-i18n="foldersTitle">Folders</span>
                <button id="toggle-folders-btn" class="px-2 py-1 bg-gray-500 rounded-lg text-white text-sm" data-i18n="collapseFoldersBtn">
                    Collapse Folders
                </button>
            </h2>
            <div id="folders-list-container">
                <div id="folders-list" class="flex flex-wrap gap-2 sm:gap-4">
                    <button id="all-items-btn" class="px-2 sm:px-3 py-1 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 rounded-lg text-white font-semibold hover:from-gray-700 hover:to-gray-900" data-i18n="allItemsBtn">
                        All Items
                    </button>
                </div>
            </div>
        </div>

        <div class="glass-effect rounded-lg p-2 sm:p-4 mb-4 sm:mb-6 animate-fade-in">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4" data-i18n="searchItemsTitle">Search Items</h2>
            <div class="flex flex-col sm:flex-row gap-2 sm:gap-4">
                <div class="flex-1 input-with-clear">
                    <input
                        id="search-query"
                        type="text"
                        placeholder="Search by URL or tags..."
                        class="flex-1"
                        data-i18n-placeholder="searchQueryPlaceholder"
                    />
                    <button class="clear-input-btn" data-target-input="search-query" data-i18n="clearBtn" title="Clear input">✕</button>
                </div>
                <div class="flex-1 input-with-clear">
                    <input
                        id="search-tags-input"
                        type="text"
                        placeholder="Search by tags (comma-separated)..."
                        list="saved-tags-datalist-search"
                        class="flex-1"
                        data-i18n-placeholder="itemTagsPlaceholder"
                    />
                    <button class="clear-input-btn" data-target-input="search-tags-input" data-i18n="clearBtn" title="Clear input">✕</button>
                </div>
                <datalist id="saved-tags-datalist-search"></datalist>
                <select id="search-type" class="flex-1">
                    <option value="all" data-i18n="allTypes">All Types</option>
                    <option value="link" data-i18n="optionLink">Link</option>
                    <option value="video" data-i18n="optionVideo">Video</option>
                    <option value="photo" data-i18n="optionPhoto">Photo</option>
                </select>
                <select id="search-folder" class="flex-1">
                    <option value="all" data-i18n="allFolders">All Folders</option>
                </select>
                <select id="search-rating" class="flex-1">
                    <option value="all" data-i18n="allRatings">Todas as Avaliações</option>
                    <option value="1">1 Estrela ou mais</option>
                    <option value="2">2 Estrelas ou mais</option>
                    <option value="3">3 Estrelas ou mais</option>
                    <option value="4">4 Estrelas ou mais</option>
                    <option value="5">5 Estrelas</option>
                    <option value="0">Não Avaliado</option>
                </select>
            </div>
        </div>

        <div class="glass-effect rounded-lg p-2 sm:p-4 animate-fade-in">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-800 mb-2 sm:mb-4" data-i18n="savedItemsTitle">Saved Items</h2>
            <div id="items-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-4 overflow-hidden">
                </div>
        </div>
    </div>
  </div>

  <div id="edit-folder-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="document.getElementById('edit-folder-modal').classList.add('hidden')">×</button>
      <h3 class="text-xl font-semibold mb-4" data-i18n="editFolderTitle">Editar Pasta</h3>
      <div class="modal-input-group">
        <label for="edit-folder-name" data-i18n="folderNameLabel">Nome da Pasta:</label>
        <input type="text" id="edit-folder-name">
      </div>
      <div class="modal-input-group">
        <label for="edit-folder-color" data-i18n="folderColorLabel">Cor da Pasta:</label>
        <select id="edit-folder-color">
          <option value="bg-blue-500" data-i18n="colorBlue">Blue</option>
          <option value="bg-green-500" data-i18n="colorGreen">Green</option>
          <option value="bg-red-500" data-i18n="colorRed">Red</option>
          <option value="bg-purple-500" data-i18n="colorPurple">Purple</option>
          <option value="bg-yellow-500" data-i18n="colorYellow">Yellow</option>
          <option value="bg-black" data-i18n="colorBlack">Black</option>
          <option value="bg-teal-600" data-i18n="colorTeal">Teal</option>
          <option value="bg-pink-600" data-i18n="colorPink">Pink</option>
        </select>
      </div>
      <div class="modal-input-group">
        <label for="edit-folder-icon" data-i18n="folderIconLabel">Ícone da Pasta:</label>
        <select id="edit-folder-icon">
          <option value="svg/tiktok.svg" data-i18n="iconTikTok">TikTok</option>
          <option value="svg/kwai.svg" data-i18n="iconKwai">Kwai</option>
          <option value="svg/facebook.svg" data-i18n="iconFacebook">Facebook</option>
          <option value="svg/instagram.svg" data-i18n="iconInstagram">Instagram</option>
          <option value="svg/youtube.svg" data-i18n="iconYouTube">YouTube</option>
          <option value="svg/dailymotion.svg" data-i18n="iconDailymotion">Dailymotion</option>
          <option value="svg/folder.svg" data-i18n="iconFolder">Folder</option>
          <option value="svg/link.svg" data-i18n="iconLink">Outro Link</option>
        </select>
      </div>
      <div class="modal-actions">
        <button id="save-folder-changes-btn" class="modal-btn confirm" data-i18n="saveChangesBtn">Salvar Alterações</button>
        <button id="delete-folder-from-modal-btn" class="modal-btn delete-folder" data-i18n="deleteFolderBtn">Excluir Pasta</button>
        <button class="modal-btn cancel" onclick="document.getElementById('edit-folder-modal').classList.add('hidden')" data-i18n="cancelBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="edit-item-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="document.getElementById('edit-item-modal').classList.add('hidden')">×</button>
      <h3 class="text-xl font-semibold mb-4" data-i18n="editItemTitle">Editar Elemento</h3>
      <div class="modal-input-group">
        <label for="edit-item-url" data-i18n="urlLabel">URL:</label>
        <input type="text" id="edit-item-url">
      </div>
      <div class="modal-input-group">
        <label for="edit-item-tags" data-i18n="tagsLabel">Etiquetas (separadas por vírgulas):</label>
        <input type="text" id="edit-item-tags" list="saved-tags-datalist">
      </div>
      <div class="modal-input-group">
        <label for="edit-item-type" data-i18n="typeLabel">Tipo:</label>
        <select id="edit-item-type">
          <option value="link" data-i18n="optionLink">Link</option>
          <option value="video" data-i18n="optionVideo">Video</option>
          <option value="photo" data-i18n="optionPhoto">Photo</option>
        </select>
      </div>
      <div class="modal-input-group">
        <label for="edit-item-folder" data-i18n="folderLabel">Pasta:</label>
        <select id="edit-item-folder">
          </select>
      </div>
      <div class="modal-input-group">
          <label for="edit-item-rating" data-i18n="ratingLabel">Avaliação:</label>
          <div id="edit-item-rating" class="star-rating justify-center">
              <input type="radio" id="edit-star-5" name="rating-edit" value="5" /><label for="edit-star-5" title="5 estrelas">★</label>
              <input type="radio" id="edit-star-4" name="rating-edit" value="4" /><label for="edit-star-4" title="4 estrelas">★</label>
              <input type="radio" id="edit-star-3" name="rating-edit" value="3" /><label for="edit-star-3" title="3 estrelas">★</label>
              <input type="radio" id="edit-star-2" name="rating-edit" value="2" /><label for="edit-star-2" title="2 estrelas">★</label>
              <input type="radio" id="edit-star-1" name="rating-edit" value="1" /><label for="edit-star-1" title="1 estrela">★</label>
              <input type="radio" id="edit-star-0" name="rating-edit" value="0" class="hidden" checked />
          </div>
      </div>
      <div class="modal-actions">
        <button id="save-item-changes-btn" class="modal-btn confirm" data-i18n="saveChangesBtn">Salvar Alterações</button>
        <button class="modal-btn cancel" onclick="document.getElementById('edit-item-modal').classList.add('hidden')" data-i18n="cancelBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="edit-tag-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="document.getElementById('edit-tag-modal').classList.add('hidden')">×</button>
      <h3 class="text-xl font-semibold mb-4" data-i18n="editTagTitle">Editar Etiqueta</h3>
      <div class="modal-input-group">
        <label for="edit-tag-name" data-i18n="tagNameLabel">Nome da Etiqueta:</label>
        <input type="text" id="edit-tag-name">
      </div>
      <div class="modal-actions">
        <button id="save-tag-changes-btn" class="modal-btn confirm" data-i18n="saveChangesBtn">Salvar Alterações</button>
        <button class="modal-btn cancel" onclick="document.getElementById('edit-tag-modal').classList.add('hidden')" data-i18n="cancelBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="manage-data-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="document.getElementById('manage-data-modal').classList.add('hidden')">×</button>
      <h3 class="text-xl font-semibold mb-4" data-i18n="manageDataTitle">Gerenciar Dados</h3>
      <div class="flex flex-col gap-4">
        <button id="export-data-option-btn" class="modal-btn confirm" data-i18n="exportDataOption">Exportar Dados</button>
        <label class="modal-btn confirm cursor-pointer" data-i18n="importDataOption">
          Importar Dados
          <input id="import-file-modal-input" type="file" accept=".json" style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0;">
        </label>
      </div>
    </div>
  </div>

  <div id="import-selection-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="document.getElementById('import-selection-modal').classList.add('hidden'); importFileModalInput.value='';">×</button>
      <h3 class="text-xl font-semibold mb-4" data-i18n="selectImportOptions">Selecionar Opções de Importação</h3>
      <div class="modal-checkbox-group">
        <label>
          <input type="checkbox" id="import-items-checkbox" checked>
          <span data-i18n="itemsCheckbox">Itens</span>
        </label>
        <label>
          <input type="checkbox" id="import-folders-checkbox" checked>
          <span data-i18n="foldersCheckbox">Pastas</span>
        </label>
        <label>
          <input type="checkbox" id="import-tags-checkbox" checked>
          <span data-i18n="tagsCheckbox">Tags</span>
        </label>
        <label>
          <input type="checkbox" id="import-theme-checkbox" checked>
          <span data-i18n="themeCheckbox">Tema</span>
        </label>
        <label>
          <input type="checkbox" id="import-language-checkbox" checked>
          <span data-i18n="languageCheckbox">Idioma</span>
        </label>
      </div>
      <div class="modal-actions">
        <button id="confirm-import-selection-btn" class="modal-btn confirm" data-i18n="confirmImportBtn">Confirmar Importação</button>
        <button class="modal-btn cancel" onclick="document.getElementById('import-selection-modal').classList.add('hidden'); importFileModalInput.value='';" data-i18n="cancelBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <div id="video-player-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="closeVideoPlayerModal()">×</button>
      <div id="video-player-iframe-container" style="width: 100%; height: 100%;"></div>
    </div>
  </div>

  <div id="loading-message" class="loading-message"></div>

  <script>
    // **Variáveis de Estado Globais:**
    // Armazenam os dados principais do aplicativo, carregados do localStorage ou inicializados.
    let items = JSON.parse(localStorage.getItem('items')) || [];
    // Garante que cada item tenha as propriedades esperadas. Isso é importante para compatibilidade com versões antigas dos dados.
    items = items.map(item => ({
      ...item,
      tags: item.tags || [], // Assegura que 'tags' é um array
      metadata: item.metadata || {}, // Assegura que 'metadata' é um objeto
      rating: item.rating !== undefined ? item.rating : 0, // Define 'rating' como 0 se não existir
      accessHistory: item.accessHistory || [] // Inicializa 'accessHistory' como um array vazio
    }));

    let folders = JSON.parse(localStorage.getItem('folders')) || [
      // Pastas padrão iniciais para o aplicativo
      { name: 'TikTok', color: 'bg-black', icon: 'svg/tiktok.svg' },
      { name: 'Kwai', color: 'bg-yellow-500', icon: 'svg/kwai.svg' },
      { name: 'Facebook', color: 'bg-blue-600', icon: 'svg/facebook.svg' },
      { name: 'Instagram', color: 'bg-pink-600', icon: 'svg/instagram.svg' },
      { name: 'YouTube', color: 'bg-red-600', icon: 'svg/youtube.svg' },
      { name: 'Dailymotion', color: 'bg-teal-600', icon: 'svg/dailymotion.svg' },
      { name: 'Outros Links', color: 'bg-gray-500', icon: 'svg/link.svg' }
    ];
    let savedTags = JSON.parse(localStorage.getItem('savedTags')) || []; // Tags salvas pelo usuário
    let theme = localStorage.getItem('theme') || 'light'; // Tema atual (claro/escuro)
    let currentLanguage = localStorage.getItem('language') || 'pt-BR'; // Idioma atual

    let selectedFolder = null; // A pasta atualmente selecionada para filtrar itens (null para "Todos os Itens")
    let currentEditingTag = null; // Armazena a tag que está sendo editada no modal
    let importedDataCache = null; // Cache temporário para os dados lidos de um arquivo JSON importado

    // **Referências a Elementos do DOM (Document Object Model):**
    // Captura elementos HTML pelo ID para manipulá-los via JavaScript.

    // Seção de Adicionar Novo Item
    const itemUrlInput = document.getElementById('item-url');
    const itemTagsInput = document.getElementById('item-tags');
    const itemTypeSelect = document.getElementById('item-type');
    const itemFolderSelect = document.getElementById('item-folder');
    const addItemBtn = document.getElementById('add-item-btn');
    const pasteLinkBtn = document.getElementById('paste-link-btn');
    const previewContainer = document.getElementById('preview-container');
    const previewImage = document.getElementById('preview-image');
    const previewTitle = document.getElementById('preview-title');
    const previewDescription = document.getElementById('preview-description');

    // Seção de Criar Nova Pasta
    const newFolderInput = document.getElementById('new-folder');
    const folderColorSelect = document.getElementById('folder-color');
    const folderIconSelect = document.getElementById('folder-icon');
    const addFolderBtn = document.getElementById('add-folder-btn');

    // Seção de Busca de Itens
    const searchQueryInput = document.getElementById('search-query');
    const searchTagsInput = document.getElementById('search-tags-input');
    const searchTypeSelect = document.getElementById('search-type');
    const searchFolderSelect = document.getElementById('search-folder');
    const searchRatingSelect = document.getElementById('search-rating');

    // Listas e Paineis Globais
    const foldersList = document.getElementById('folders-list');
    const foldersListContainer = document.getElementById('folders-list-container'); // NEW: Container for the collapsible folders list
    const toggleFoldersBtn = document.getElementById('toggle-folders-btn'); // NEW: Button to collapse/expand folders
    const allItemsBtn = document.getElementById('all-items-btn'); // Botão "Todos os Itens" na lista de pastas
    const itemsList = document.getElementById('items-list'); // Contêiner para a lista de itens salvos
    const settingsBtn = document.getElementById('settings-btn'); // Botão para abrir o painel de configurações
    const settingsPanel = document.getElementById('settings-panel'); // O painel de configurações em si
    const toggleThemeBtn = document.getElementById('toggle-theme-btn'); // Botão para alternar o tema
    const clearItemsBtn = document.getElementById('clear-items-btn'); // Botão para limpar todos os itens
    const manageDataBtn = document.getElementById('manage-data-btn'); // Botão para abrir o modal de gerenciamento de dados
    const languageSelect = document.getElementById('language-select'); // Select de idioma

    // Elementos do Gerenciamento de Tags (no Painel de Configurações)
    const newTagInput = document.getElementById('new-tag-input');
    const addTagBtn = document.getElementById('add-tag-btn');
    const tagsList = document.getElementById('tags-list'); // Lista visual das tags salvas
    const savedTagsDatalist = document.getElementById('saved-tags-datalist'); // Datalist para autocompletar tags ao adicionar item
    const savedTagsDatalistSearch = document.getElementById('saved-tags-datalist-search'); // Datalist para autocompletar tags na busca

    // Elementos dos Modais de Edição (Pasta, Item, Tag)
    const editFolderModal = document.getElementById('edit-folder-modal');
    const editFolderNameInput = document.getElementById('edit-folder-name');
    const editFolderColorSelect = document.getElementById('edit-folder-color');
    const editFolderIconSelect = document.getElementById('edit-folder-icon');
    const saveFolderChangesBtn = document.getElementById('save-folder-changes-btn');
    const deleteFolderFromModalBtn = document.getElementById('delete-folder-from-modal-btn');

    const editItemModal = document.getElementById('edit-item-modal');
    const editItemUrlInput = document.getElementById('edit-item-url');
    const editItemTagsInput = document.getElementById('edit-item-tags');
    const editItemTypeSelect = document.getElementById('edit-item-type');
    const editItemFolderSelect = document.getElementById('edit-item-folder');
    const editItemRatingInputs = document.querySelectorAll('#edit-item-rating input[name="rating-edit"]'); // Inputs de rádio para avaliação
    const saveItemChangesBtn = document.getElementById('save-item-changes-btn');

    const editTagModal = document.getElementById('edit-tag-modal');
    const editTagNameInput = document.getElementById('edit-tag-name');
    const saveTagChangesBtn = document.getElementById('save-tag-changes-btn');

    // Elementos do Modal de Gerenciamento de Dados (Import/Export)
    const manageDataModal = document.getElementById('manage-data-modal');
    const exportDataOptionBtn = document.getElementById('export-data-option-btn');
    const importFileModalInput = document.getElementById('import-file-modal-input'); // Input de arquivo para importação
    const loadingMessage = document.getElementById('loading-message'); // Mensagem de carregamento

    // Elementos do Modal de Seleção de Opções de Importação
    const importSelectionModal = document.getElementById('import-selection-modal');
    const importItemsCheckbox = document.getElementById('import-items-checkbox');
    const importFoldersCheckbox = document.getElementById('import-folders-checkbox');
    const importTagsCheckbox = document.getElementById('import-tags-checkbox');
    const importThemeCheckbox = document.getElementById('import-theme-checkbox');
    const importLanguageCheckbox = document.getElementById('import-language-checkbox');
    const confirmImportSelectionBtn = document.getElementById('confirm-import-selection-btn');

    // Elementos do Sistema de Abas
    const tabButtons = document.querySelectorAll('.tab-button'); // Todos os botões das abas
    const tabContents = document.querySelectorAll('.tab-content'); // Todos os contêineres de conteúdo das abas

    // Elementos específicos do Dashboard
    const dashboardTotalItems = document.getElementById('dashboard-total-items');
    const dashboardItemsByType = document.getElementById('dashboard-items-by-type');
    const dashboardTotalFolders = document.getElementById('dashboard-total-folders');
    const dashboardItemsByFolder = document.getElementById('dashboard-items-by-folder');
    const dashboardTotalTags = document.getElementById('dashboard-total-tags');
    const dashboardTopTags = document.getElementById('dashboard-top-tags');
    const dashboardItemsByRating = document.getElementById('dashboard-items-by-rating');
    const dashboardCurrentTheme = document.getElementById('dashboard-current-theme');
    const dashboardCurrentLanguage = document.getElementById('dashboard-current-language');
    const dashboardLastAccessedItems = document.getElementById('dashboard-last-accessed-items'); // Lista dos últimos acessos
    const dashboardMostAccessedVideos = document.getElementById('dashboard-most-accessed-videos'); // Lista dos vídeos mais acessados

    // Elementos do Reprodutor de Vídeo (modal)
    const videoPlayerModal = document.getElementById('video-player-modal'); // O modal completo do reprodutor
    const videoPlayerIframeContainer = document.getElementById('video-player-iframe-container'); // Contêiner onde o iframe do vídeo será injetado


    // **Objeto de Traduções:**
    // Contém todas as strings do aplicativo em diferentes idiomas para internacionalização.
    window.translations = {
      'pt-BR': {
        appTitle: 'Links Preview Organizer2.0',
        settingsBtn: 'Configurações',
        exportBtn: 'Exportar',
        manageDataBtn: 'Gerenciar Dados',
        settingsTitle: 'Configurações',
        toggleDarkThemeBtn: 'Alternar Tema Escuro',
        clearAllItemsBtn: 'Limpar Todos os Itens',
        importBtn: 'Importar',
        selectImportOptions: 'Selecionar Opções de Importação',
        foldersCheckbox: 'Pastas',
        itemsCheckbox: 'Itens',
        tagsCheckbox: 'Tags',
        themeCheckbox: 'Tema',
        languageCheckbox: 'Idioma',
        confirmImportBtn: 'Confirmar Importação',
        languageLabel: 'Idioma:',
        addNewItemTitle: 'Adicionar Novo Item',
        itemUrlPlaceholder: 'Inserir ou colar URL (ex: vídeo, foto, site)',
        itemTagsPlaceholder: 'Tags (ex: inspiração, trabalho, separadas por vírgulas)',
        pasteLinkBtn: 'Colar Link',
        optionLink: 'Link',
        optionVideo: 'Vídeo',
        optionPhoto: 'Foto',
        addItemBtn: 'Adicionar Item',
        createNewFolderTitle: 'Criar Nova Pasta',
        newFolderNamePlaceholder: 'Nome da nova pasta',
        colorBlue: 'Azul',
        colorGreen: 'Verde',
        colorRed: 'Vermelho',
        colorPurple: 'Roxo',
        colorYellow: 'Amarelo',
        colorBlack: 'Preto',
        colorTeal: 'Ciano',
        colorPink: 'Rosa',
        iconTikTok: 'TikTok',
        iconKwai: 'Kwai',
        iconFacebook: 'Facebook',
        iconInstagram: 'Instagram',
        iconYouTube: 'YouTube',
        iconDailymotion: 'Dailymotion',
        iconFolder: 'Pasta',
        iconLink: 'Outro Link',
        addFolderBtn: 'Adicionar Pasta',
        foldersTitle: 'Pastas',
        allItemsBtn: 'Todos os Itens',
        searchItemsTitle: 'Buscar Itens',
        searchQueryPlaceholder: 'Buscar por URL ou título/descrição...',
        searchTagsPlaceholder: 'Buscar por tags (separadas por vírgulas)...',
        allTypes: 'Todos os Tipos',
        allFolders: 'Todas as Pastas',
        allRatings: 'Todas as Avaliações',
        savedItemsTitle: 'Itens Salvos',
        editFolderTitle: 'Editar Pasta',
        folderNameLabel: 'Nome da Pasta:',
        folderColorLabel: 'Cor da Pasta:',
        folderIconLabel: 'Ícone da Pasta:',
        saveChangesBtn: 'Salvar Alterações',
        deleteFolderBtn: 'Excluir Pasta',
        cancelBtn: 'Cancelar',
        editItemTitle: 'Editar Elemento',
        urlLabel: 'URL:',
        tagsLabel: 'Tags (separadas por vírgula):',
        typeLabel: 'Tipo:',
        folderLabel: 'Pasta:',
        ratingLabel: 'Avaliação:',
        copyBtn: 'Copiar',
        editBtn: 'Editar',
        deleteBtn: 'Excluir',
        rateBtn: 'Avaliar',
        noItemsFound: 'Nenhum item encontrado.',
        itemType: 'Tipo',
        itemFolder: 'Pasta',
        noFolder: 'N/A',
        youtubeVideoPrefix: 'Vídeo do YouTube',
        youtubeVideoDescription: 'Assista a este vídeo no YouTube.',
        dailymotionVideoPrefix: 'Vídeo do Dailymotion',
        dailymotionVideoDescription: 'Assista a este vídeo no Dailymotion.',
        instagramLinkPrefix: 'Link do Instagram',
        instagramLinkDescription: 'Ver este conteúdo no Instagram.',
        tiktokVideoPrefix: 'Vídeo do TikTok',
        tiktokVideoDescription: 'Veja este vídeo no TikTok.',
        kwaiVideoPrefix: 'Vídeo do Kwai',
        kwaiVideoDescription: 'Veja este vídeo no Kwai.',
        facebookLinkPrefix: 'Link do Facebook',
        facebookLinkDescription: 'Veja este conteúdo no Facebook.',
        genericLinkPrefix: 'Link',
        genericContentFrom: 'Conteúdo de',
        noMetadataAvailable: 'Nenhum metadado disponível',
        noPreview: 'Sem Pré-visualização',
        loadingPreview: 'Carregando pré-visualização...',
        fetchingPreview: 'Buscando pré-visualização...',
        invalidUrl: 'Link Inválido',
        enterValidUrl: 'Por favor, insira uma URL válida.',
        pasteFailed: 'Falha ao colar: O navegador pode ter impedido o acesso à área de transferência.',
        urlCopied: 'URL copiada para a área de transferência!',
        copyFailed: 'Falha ao copiar: Por favor, tente copiar manualmente.',
        confirmDeleteItem: 'Tem certeza de que deseja excluir este item?',
        confirmClearAllItems: 'Tem certeza de que deseja limpar todos os itens?',
        confirmImport: 'Confirmar importação? Isso pode substituir dados existentes. Você pode escolher quais dados importar.',
        folderAlreadyExists: (name) => `A pasta "${name}" já existe.`,
        folderNameEmpty: 'Por favor, insira um nome para a pasta.',
        confirmDeleteFolder: (name, linksCount) => {
            if (linksCount > 0) {
                return `Tem certeza de que deseja excluir a pasta "${name}"? Todos os ${linksCount} links dentro dela serão movidos para "All Items".`;
            } else {
                return `Tem certeza de que deseja excluir a pasta "${name}"? Não há links nesta pasta.`;
            }
        },
        invalidJsonFile: 'Arquivo JSON inválido.',
        yesBtn: 'Sim',
        noBtn: 'Não',
        okBtn: 'OK',
        manageTagsTitle: 'Gerenciar Tags',
        newTagPlaceholder: 'Nome da nova tag',
        addTagBtn: 'Adicionar Tag',
        editTagTitle: 'Editar Tag',
        tagNameLabel: 'Nome da Tag:',
        itemsInFolder: 'itens',
        dashboardTab: 'Dashboard',
        createSaveTab: 'Criar/Salvar Links',
        foldersItemsTab: 'Pastas & Itens Salvos',
        dashboardTitle: 'Dashboard',
        dashboardContent: 'Bem-vindo ao seu painel! Aqui você encontrará um resumo de seus dados.',
        totalItems: 'Total de Itens',
        itemsByType: 'Itens por Tipo',
        totalFolders: 'Total de Pastas',
        itemsByFolder: 'Itens por Pasta',
        totalTags: 'Total de Tags',
        topTags: 'Tags Mais Usadas',
        itemsByRating: 'Itens por Avaliação',
        systemInfo: 'Informações do Sistema',
        currentTheme: 'Tema Atual:',
        currentLanguage: 'Idioma Atual:',
        linkType: 'Link',
        videoType: 'Vídeo',
        photoType: 'Foto',
        noRating: 'Não Avaliado',
        star: 'Estrela',
        stars: 'Estrelas',
        noFolderAssigned: 'Não atribuído',
        dataPlaceholder: 'Nenhum dado',
        lastAccessedItemsTitle: 'Últimos Acessos (Vídeos)',
        accessedOn: 'Acessado em',
        mostAccessedItemsTitle: 'Vídeos Mais Acessados',
        copyIdBtn: 'Copiar ID',
        videoPlayerTitle: 'Reprodutor de Vídeo',
        collapseFoldersBtn: 'Recolher Pastas', // NEW
        expandFoldersBtn: 'Expandir Pastas' // NEW
      },
      'en': {
        appTitle: 'Liquid Glass Organizer',
        settingsBtn: 'Settings',
        exportBtn: 'Export',
        manageDataBtn: 'Manage Data',
        settingsTitle: 'Settings',
        toggleDarkThemeBtn: 'Toggle Dark Theme',
        clearAllItemsBtn: 'Clear All Items',
        importBtn: 'Import',
        selectImportOptions: 'Select Import Options',
        foldersCheckbox: 'Folders',
        itemsCheckbox: 'Items',
        tagsCheckbox: 'Tags',
        themeCheckbox: 'Theme',
        languageCheckbox: 'Language',
        confirmImportBtn: 'Confirm Import',
        languageLabel: 'Language:',
        addNewItemTitle: 'Add New Item',
        itemUrlPlaceholder: 'Enter or paste URL (e.g., video, photo, website)',
        itemTagsPlaceholder: 'Tags (e.g., inspiration, work, separated by commas)',
        pasteLinkBtn: 'Paste Link',
        optionLink: 'Link',
        optionVideo: 'Video',
        optionPhoto: 'Photo',
        addItemBtn: 'Add Item',
        createNewFolderTitle: 'Create New Folder',
        newFolderNamePlaceholder: 'New folder name',
        colorBlue: 'Blue',
        colorGreen: 'Green',
        colorRed: 'Red',
        colorPurple: 'Purple',
        colorYellow: 'Yellow',
        colorBlack: 'Black',
        colorTeal: 'Teal',
        colorPink: 'Pink',
        iconTikTok: 'TikTok',
        iconKwai: 'Kwai',
        iconFacebook: 'Facebook',
        iconInstagram: 'Instagram',
        iconYouTube: 'YouTube',
        iconDailymotion: 'Dailymotion',
        iconFolder: 'Folder',
        iconLink: 'Other Link',
        addFolderBtn: 'Add Folder',
        foldersTitle: 'Folders',
        allItemsBtn: 'All Items',
        searchItemsTitle: 'Search Items',
        searchQueryPlaceholder: 'Search by URL or title/description...',
        searchTagsPlaceholder: 'Search by tags (comma-separated)...',
        allTypes: 'All Types',
        allFolders: 'All Folders',
        allRatings: 'All Ratings',
        savedItemsTitle: 'Saved Items',
        editFolderTitle: 'Edit Folder',
        folderNameLabel: 'Folder Name:',
        folderColorLabel: 'Folder Color:',
        folderIconLabel: 'Folder Icon:',
        saveChangesBtn: 'Save Changes',
        deleteFolderBtn: 'Delete Folder',
        cancelBtn: 'Cancel',
        editItemTitle: 'Edit Item',
        urlLabel: 'URL:',
        tagsLabel: 'Tags (comma-separated):',
        typeLabel: 'Type:',
        folderLabel: 'Folder:',
        ratingLabel: 'Rating:',
        copyBtn: 'Copy',
        editBtn: 'Edit',
        deleteBtn: 'Delete',
        rateBtn: 'Rate',
        noItemsFound: 'No items found.',
        itemType: 'Type',
        itemFolder: 'Folder',
        noFolder: 'N/A',
        youtubeVideoPrefix: 'YouTube Video',
        youtubeVideoDescription: 'Watch this video on YouTube.',
        dailymotionVideoPrefix: 'Dailymotion Video',
        dailymotionVideoDescription: 'Watch this video on Dailymotion.',
        instagramLinkPrefix: 'Instagram Link',
        instagramLinkDescription: 'View this content on Instagram.',
        tiktokVideoPrefix: 'TikTok Video',
        tiktokVideoDescription: 'View this video on TikTok.',
        kwaiVideoPrefix: 'Kwai Video',
        kwaiVideoDescription: 'View this video on Kwai.',
        facebookLinkPrefix: 'Facebook Link',
        facebookLinkDescription: 'View this content on Facebook.',
        genericLinkPrefix: 'Link',
        genericContentFrom: 'Content from',
        noMetadataAvailable: 'No metadata available',
        noPreview: 'No Preview',
        loadingPreview: 'Loading preview...',
        fetchingPreview: 'Fetching preview...',
        invalidUrl: 'Invalid Link',
        enterValidUrl: 'Please enter a valid URL.',
        pasteFailed: 'Paste failed: Browser may have blocked clipboard access.',
        urlCopied: 'URL copied to clipboard!',
        copyFailed: 'Copy failed: Please try copying manually.',
        confirmDeleteItem: 'Are you sure you want to delete this item?',
        confirmClearAllItems: 'Are you sure you want to clear all items?',
        confirmImport: 'Confirm import? This may overwrite existing data. You can choose which data to import.',
        folderAlreadyExists: (name) => `Folder "${name}" already exists.`,
        folderNameEmpty: 'Please enter a folder name.',
        confirmDeleteFolder: (name, linksCount) => {
            if (linksCount > 0) {
                return `Are you sure you want to delete folder "${name}"? All ${linksCount} links inside it will be moved to "All Items".`;
            } else {
                return `Are you sure you want to delete folder "${name}"? There are no links in this folder.`;
            }
        },
        invalidJsonFile: 'Invalid JSON file.',
        yesBtn: 'Yes',
        noBtn: 'No',
        okBtn: 'OK',
        manageTagsTitle: 'Manage Tags',
        newTagPlaceholder: 'New tag name',
        addTagBtn: 'Add Tag',
        editTagTitle: 'Edit Tag',
        tagNameLabel: 'Tag Name:',
        itemsInFolder: 'items',
        dashboardTab: 'Dashboard',
        createSaveTab: 'Create/Save Links',
        foldersItemsTab: 'Folders & Saved Items',
        dashboardTitle: 'Dashboard',
        dashboardContent: 'Welcome to your dashboard! Here you will find a summary of your data.',
        totalItems: 'Total Items',
        itemsByType: 'Items by Type',
        totalFolders: 'Total Folders',
        itemsByFolder: 'Items by Folder',
        totalTags: 'Total Tags',
        topTags: 'Most Used Tags',
        itemsByRating: 'Items by Rating',
        systemInfo: 'System Info',
        currentTheme: 'Current Theme:',
        currentLanguage: 'Current Language:',
        linkType: 'Link',
        videoType: 'Video',
        photoType: 'Photo',
        noRating: 'Not Rated',
        star: 'Star',
        stars: 'Stars',
        noFolderAssigned: 'Not assigned',
        dataPlaceholder: 'No data',
        lastAccessedItemsTitle: 'Last Accessed Items (Videos)',
        accessedOn: 'Accessed on',
        mostAccessedItemsTitle: 'Most Accessed Videos',
        copyIdBtn: 'Copy ID',
        videoPlayerTitle: 'Video Player',
        collapseFoldersBtn: 'Collapse Folders', // NEW
        expandFoldersBtn: 'Expand Folders' // NEW
      },
      'es': {
        appTitle: 'Organizador Vidrio Líquido',
        settingsBtn: 'Ajustes',
        exportBtn: 'Exportar',
        manageDataBtn: 'Gestionar Datos',
        settingsTitle: 'Ajustes',
        toggleDarkThemeBtn: 'Alternar Tema Oscuro',
        clearAllItemsBtn: 'Borrar Todos los Elementos',
        importBtn: 'Importar',
        selectImportOptions: 'Seleccionar Opciones de Importación',
        foldersCheckbox: 'Carpetas',
        itemsCheckbox: 'Elementos',
        tagsCheckbox: 'Etiquetas',
        themeCheckbox: 'Tema',
        languageCheckbox: 'Idioma',
        confirmImportBtn: 'Confirmar Importación',
        languageLabel: 'Idioma:',
        addNewItemTitle: 'Añadir Nuevo Elemento',
        itemUrlPlaceholder: 'Introducir o pegar URL (ej: vídeo, foto, sitio web)',
        itemTagsPlaceholder: 'Etiquetas (ej: inspiración, trabajo, separadas por comas)',
        pasteLinkBtn: 'Pegar Enlace',
        optionLink: 'Enlace',
        optionVideo: 'Vídeo',
        optionPhoto: 'Foto',
        addItemBtn: 'Añadir Elemento',
        createNewFolderTitle: 'Crear Nueva Carpeta',
        newFolderNamePlaceholder: 'Nombre de la nueva carpeta',
        colorBlue: 'Azul',
        colorGreen: 'Verde',
        colorRed: 'Rojo',
        colorPurple: 'Morado',
        colorYellow: 'Amarillo',
        colorBlack: 'Negro',
        colorTeal: 'Cian',
        colorPink: 'Rosa',
        iconTikTok: 'TikTok',
        iconKwai: 'Kwai',
        iconFacebook: 'Facebook',
        iconInstagram: 'Instagram',
        iconYouTube: 'YouTube',
        iconDailymotion: 'Dailymotion',
        iconFolder: 'Carpeta',
        iconLink: 'Otro Enlace',
        addFolderBtn: 'Añadir Carpeta',
        foldersTitle: 'Carpetas',
        allItemsBtn: 'Todos los Elementos',
        searchItemsTitle: 'Buscar Elementos',
        searchQueryPlaceholder: 'Buscar por URL o título/descripción...',
        searchTagsPlaceholder: 'Buscar por etiquetas (separadas por comas)...',
        allTypes: 'Todos los Tipos',
        allFolders: 'Todas las Carpetas',
        allRatings: 'Todas las Valoraciones',
        savedItemsTitle: 'Elementos Guardados',
        editFolderTitle: 'Editar Carpeta',
        folderNameLabel: 'Nombre de la Carpeta:',
        folderColorLabel: 'Cor de la Carpeta:',
        folderIconLabel: 'Icono de la Carpeta:',
        saveChangesBtn: 'Guardar Cambios',
        deleteFolderBtn: 'Eliminar Carpeta',
        cancelBtn: 'Cancelar',
        editItemTitle: 'Editar Elemento',
        urlLabel: 'URL:',
        tagsLabel: 'Etiquetas (separadas por comas):',
        typeLabel: 'Tipo:',
        folderLabel: 'Carpeta:',
        ratingLabel: 'Valoración:',
        copyBtn: 'Copiar',
        editBtn: 'Editar',
        deleteBtn: 'Eliminar',
        rateBtn: 'Valorar',
        noItemsFound: 'No se encontraron elementos.',
        itemType: 'Tipo',
        itemFolder: 'Carpeta',
        noFolder: 'N/A',
        youtubeVideoPrefix: 'Video de YouTube',
        youtubeVideoDescription: 'Mira este video en YouTube.',
        dailymotionVideoPrefix: 'Video de Dailymotion',
dailymotionVideoDescription: 'Mira este video en Dailymotion.',
        instagramLinkPrefix: 'Enlace de Instagram',
        instagramLinkDescription: 'Ver este contenido en Instagram.',
        tiktokVideoPrefix: 'Video de TikTok',
        tiktokVideoDescription: 'Mira este video en TikTok.',
        kwaiVideoPrefix: 'Video de Kwai',
        kwaiVideoDescription: 'Mira este video en Kwai.',
        facebookLinkPrefix: 'Enlace de Facebook',
        facebookLinkDescription: 'Ver este contenido en Facebook.',
        genericLinkPrefix: 'Enlace',
        genericContentFrom: 'Contenido de',
        noMetadataAvailable: 'No hay metadatos disponibles',
        noPreview: 'Sin Vista Previa',
        loadingPreview: 'Cargando vista previa...',
        fetchingPreview: 'Obteniendo vista previa...',
        invalidUrl: 'Enlace Inválido',
        enterValidUrl: 'Por favor, introduce una URL válida.',
        pasteFailed: 'Error al pegar: El navegador pudo haber bloqueado el acceso al portapapeles.',
        urlCopied: '¡URL copiada al portapapeles!',
        copyFailed: 'Error al copiar: Por favor, intenta copiar manualmente.',
        confirmDeleteItem: '¿Estás seguro de que quieres eliminar este elemento?',
        confirmClearAllItems: '¿Estás seguro de que quieres borrar todos los elementos?',
        confirmImport: '¿Estás seguro de que quieres importar los datos seleccionados? Esto sobrescribirá tus datos existentes.',
        folderAlreadyExists: (name) => `La carpeta "${name}" ya existe.`,
        folderNameEmpty: 'Por favor, introduce un nombre para la carpeta.',
        confirmDeleteFolder: (name, linksCount) => {
            if (linksCount > 0) {
                return `¿Estás seguro de que quieres eliminar la carpeta "${name}"? Todos los ${linksCount} enlaces dentro de ella se moverán a "Todos los Elementos".`;
            } else {
                return `¿Estás seguro de que quieres eliminar la carpeta "${name}"? No hay enlaces en esta carpeta.`;
            }
        },
        invalidJsonFile: 'Archivo JSON inválido. Asegúrate de que sea un JSON válido.',
        yesBtn: 'Sí',
        noBtn: 'No',
        okBtn: 'OK',
        manageTagsTitle: 'Administrar Etiquetas',
        newTagPlaceholder: 'Nombre de la nueva etiqueta',
        addTagBtn: 'Añadir Etiqueta',
        editTagTitle: 'Editar Etiqueta',
        tagNameLabel: 'Nombre de la Etiqueta:',
        itemsInFolder: 'elementos',
        dashboardTab: 'Dashboard',
        createSaveTab: 'Crear/Guardar Enlaces',
        foldersItemsTab: 'Carpetas y Elementos Guardados',
        dashboardTitle: 'Dashboard',
        dashboardContent: '¡Bienvenido a tu panel! Aquí encontrarás un resumen de tus datos.',
        totalItems: 'Total de Elementos',
        itemsByType: 'Elementos por Tipo',
        totalFolders: 'Total de Carpetas',
        itemsByFolder: 'Elementos por Carpeta',
        totalTags: 'Total de Etiquetas',
        topTags: 'Etiquetas Más Usadas',
        itemsByRating: 'Elementos por Valoración',
        systemInfo: 'Información del Sistema',
        currentTheme: 'Tema Actual:',
        currentLanguage: 'Idioma Actual:',
        linkType: 'Enlace',
        videoType: 'Video',
        photoType: 'Foto',
        noRating: 'No Valorado',
        star: 'Estrella',
        stars: 'Estrellas',
        noFolderAssigned: 'No asignado',
        dataPlaceholder: 'No hay datos',
        lastAccessedItemsTitle: 'Últimos Elementos Accedidos (Vídeos)',
        accessedOn: 'Accedido el',
        mostAccessedItemsTitle: 'Elementos Más Accedidos',
        copyIdBtn: 'Copiar ID',
        videoPlayerTitle: 'Reproductor de Vídeo',
        collapseFoldersBtn: 'Recolher Carpetas', // NEW
        expandFoldersBtn: 'Expandir Carpetas' // NEW
      }
    };

    // Lógica para alternar entre as abas do aplicativo
    function showTab(tabId) {
        // Oculta todos os conteúdos das abas
        tabContents.forEach(content => {
            content.classList.remove('active');
        });
        // Desativa todos os botões das abas
        tabButtons.forEach(button => {
            button.classList.remove('active');
        });

        // Ativa o conteúdo da aba selecionada
        document.getElementById(tabId).classList.add('active');
        // Ativa o botão correspondente à aba selecionada
        document.querySelector(`.tab-button[data-tab="${tabId.replace('-tab', '')}"]`).classList.add('active');

        // Renderiza itens ou atualiza o dashboard ao mudar de aba, garantindo dados corretos
        if (tabId === 'folders-items-tab') {
            renderItems(); // Renderiza a lista de itens
            updateFolderSelects(); // Atualiza a lista de pastas e seus contadores
        } else if (tabId === 'dashboard-tab') {
            updateDashboard(); // Atualiza todas as estatísticas do dashboard
        }
    }

    // Adiciona event listeners para os botões das abas
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            const tabId = button.dataset.tab + '-tab'; // Obtém o ID da aba a ser mostrada
            showTab(tabId); // Chama a função para mostrar a aba
        });
    });

    // Função auxiliar para extrair o ID de um vídeo de várias plataformas
    function getVideoIdFromUrl(url, type) {
        if (!url) return null; // Retorna nulo se a URL for vazia

        // Expressões regulares para extrair o ID de cada plataforma
        if (type === 'youtube') {
            const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^#\&\?]*).*/;
            const match = url.match(regex);
            return match ? match[1] : null; // Retorna o ID do YouTube
        } else if (type === 'dailymotion') {
            const regex = /(?:dailymotion\.com\/(?:video|embed)\/|dai\.ly\/)([a-zA-Z0-9]+)/;
            const match = url.match(regex);
            return match ? match[1] : null; // Retorna o ID do Dailymotion
        } else if (type === 'tiktok') {
            const regex = /(?:tiktok\.com\/@(?:[a-zA-Z0-9_]+\/video|v)\/)([0-9]+)/;
            const match = regex.exec(url);
            return match ? match[1] : null; // Retorna o ID do TikTok
        } else if (type === 'kwai') {
            const regex = /(?:kwai\.com\/(?:photo|video)\/)([0-9]+)/;
            const match = regex.exec(url);
            return match ? match[1] : null; // Retorna o ID do Kwai
        } else if (type === 'facebook') {
            // Para Facebook, geralmente não há um ID simples para incorporação direta sem o SDK.
            // Retorna a URL completa como fallback para que o usuário possa abrir.
            return url; 
        }
        return null; // Retorna nulo para outros tipos ou se o ID não for encontrado
    }

    // Função para atualizar os dados e a renderização do Dashboard
    function updateDashboard() {
        // Atualiza o total de itens
        dashboardTotalItems.textContent = items.length;

        // Atualiza o contador de itens por tipo (Link, Vídeo, Foto)
        const itemsByTypeCounts = items.reduce((acc, item) => {
            acc[item.type] = (acc[item.type] || 0) + 1;
            return acc;
        }, {});
        dashboardItemsByType.innerHTML = ''; // Limpa a lista existente
        if (Object.keys(itemsByTypeCounts).length > 0) {
            for (const type in itemsByTypeCounts) {
                // Usa tradução para o nome do tipo
                const typeName = window.translations[currentLanguage][`${type}Type`] || type;
                dashboardItemsByType.innerHTML += `<li><span>${typeName}:</span> <span>${itemsByTypeCounts[type]}</span></li>`;
            }
        } else {
            dashboardItemsByType.innerHTML = `<li><span>${window.translations[currentLanguage]['dataPlaceholder']}</span></li>`;
        }

        // Atualiza o total de pastas
        dashboardTotalFolders.textContent = folders.length;

        // Atualiza o contador de itens por pasta
        const itemsByFolderCounts = items.reduce((acc, item) => {
            const folderName = item.folder || window.translations[currentLanguage]['noFolderAssigned'];
            acc[folderName] = (acc[folderName] || 0) + 1;
            return acc;
        }, {});
        dashboardItemsByFolder.innerHTML = ''; // Limpa a lista existente
        if (Object.keys(itemsByFolderCounts).length > 0) {
            // Ordena as pastas por contagem (decrescente) e depois por nome (alfabética)
            const sortedFolders = Object.entries(itemsByFolderCounts).sort(([nameA, countA], [nameB, countB]) => {
                if (countB !== countA) return countB - countA;
                return nameA.localeCompare(nameB);
            });
            sortedFolders.forEach(([folderName, count]) => {
                dashboardItemsByFolder.innerHTML += `<li><span>${folderName}:</span> <span>${count}</span></li>`;
            });
        } else {
            dashboardItemsByFolder.innerHTML = `<li><span>${window.translations[currentLanguage]['dataPlaceholder']}</span></li>`;
        }
        
        // Atualiza o total de tags
        dashboardTotalTags.textContent = savedTags.length;

        // Atualiza as tags mais usadas (limitado às 5 primeiras)
        const tagCounts = {};
        items.forEach(item => {
            if (item.tags) {
                item.tags.forEach(tag => {
                    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
                });
            }
        });
        const sortedTags = Object.entries(tagCounts).sort(([, a], [, b]) => b - a).slice(0, 5);
        dashboardTopTags.innerHTML = ''; // Limpa a lista existente
        if (sortedTags.length > 0) {
            sortedTags.forEach(([tag, count]) => {
                dashboardTopTags.innerHTML += `<li><span>${tag}:</span> <span>${count}</span></li>`;
            });
        } else {
            dashboardTopTags.innerHTML = `<li><span>${window.translations[currentLanguage]['dataPlaceholder']}</span></li>`;
        }

        // Atualiza os itens por avaliação (estrelas)
        const ratingCounts = items.reduce((acc, item) => {
            const rating = item.rating !== undefined ? item.rating : 0;
            acc[rating] = (acc[rating] || 0) + 1;
            return acc;
        }, {});
        dashboardItemsByRating.innerHTML = ''; // Limpa a lista existente
        const sortedRatings = Object.keys(ratingCounts).sort((a, b) => b - a); // Ordena de 5 a 0 estrelas
        if (sortedRatings.length > 0) {
            sortedRatings.forEach(rating => {
                const displayRating = parseInt(rating) === 0 
                    ? window.translations[currentLanguage]['noRating'] 
                    : '★'.repeat(parseInt(rating)) + (parseInt(rating) === 1 ? ` (${window.translations[currentLanguage]['star']})` : ` (${window.translations[currentLanguage]['stars']})`);
                dashboardItemsByRating.innerHTML += `<li><span>${displayRating}:</span> <span>${ratingCounts[rating]}</span></li>`;
            });
        } else {
            dashboardItemsByRating.innerHTML = `<li><span>${window.translations[currentLanguage]['dataPlaceholder']}</span></li>`;
        }

        // Atualiza informações do sistema (Tema e Idioma atuais)
        dashboardCurrentTheme.textContent = theme === 'light' ? 'Light' : 'Dark';
        dashboardCurrentLanguage.textContent = currentLanguage;

        // Últimos Acessos (Apenas Vídeos) - Limite de 5
        const allVideoAccesses = [];
        // Filtra apenas itens do tipo 'video' que possuem histórico de acesso
        items.filter(item => item.type === 'video' && item.accessHistory && item.accessHistory.length > 0).forEach(videoItem => {
            // Para cada acesso no histórico do vídeo, cria uma entrada para a lista
            videoItem.accessHistory.forEach(timestamp => {
                allVideoAccesses.push({
                    item: videoItem, // Referência ao objeto do item
                    timestamp: timestamp // O timestamp do acesso
                });
            });
        });

        // Ordena os acessos do mais recente para o mais antigo
        allVideoAccesses.sort((a, b) => b.timestamp - a.timestamp); 
        const lastAccessedVideos = allVideoAccesses.slice(0, 5); // Pega os 5 últimos

        dashboardLastAccessedItems.innerHTML = ''; // Limpa a lista existente
        if (lastAccessedVideos.length > 0) {
            lastAccessedVideos.forEach(access => {
                const accessDate = new Date(access.timestamp).toLocaleDateString(currentLanguage, { day: '2-digit', month: '2-digit', year: 'numeric' });
                const accessTime = new Date(access.timestamp).toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit' });
                const videoId = getVideoIdFromUrl(access.item.url, access.item.type); // Obtém o ID do vídeo para copiar

                dashboardLastAccessedItems.innerHTML += `
                    <li>
                        <div class="item-info-row">
                            <img src="${access.item.metadata.image}" alt="Thumb" class="item-thumbnail" onerror="this.src='https://placehold.co/40?text=No+Preview'">
                            <span class="truncate">${access.item.metadata.title}</span>
                        </div>
                        <span class="text-xs text-gray-500 flex-shrink-0">${window.translations[currentLanguage]['accessedOn']} ${accessDate} ${accessTime}</span>
                        <button class="copy-id-btn" data-video-id="${videoId || access.item.url}" title="${window.translations[currentLanguage]['copyIdBtn']}">
                            ${window.translations[currentLanguage]['copyIdBtn']}
                        </button>
                    </li>`;
            });
        } else {
            dashboardLastAccessedItems.innerHTML = `<li><span>${window.translations[currentLanguage]['dataPlaceholder']}</span></li>`;
        }

        // Vídeos Mais Acessados (por contagem total de acessos) - Limite de 5
        const videoAccessCounts = {};
        // Filtra apenas itens do tipo 'video'
        items.filter(item => item.type === 'video').forEach(videoItem => {
            videoAccessCounts[videoItem.id] = (videoItem.accessHistory ? videoItem.accessHistory.length : 0);
        });
        const sortedMostAccessedVideos = Object.entries(videoAccessCounts)
            .map(([id, count]) => {
                const item = items.find(i => i.id == id); // Encontra o objeto item original pelo ID
                return { item, count }; // Retorna um objeto com o item e sua contagem de acessos
            })
            .filter(entry => entry.item && entry.count > 0) // Garante que o item exista e tenha acessos
            .sort((a, b) => b.count - a.count) // Ordena pela contagem de acessos (decrescente)
            .slice(0, 5); // Pega os 5 vídeos mais acessados

        dashboardMostAccessedVideos.innerHTML = ''; // Limpa a lista existente
        if (sortedMostAccessedVideos.length > 0) {
            sortedMostAccessedVideos.forEach(entry => {
                const videoId = getVideoIdFromUrl(entry.item.url, entry.item.type); // Obtém o ID do vídeo para copiar
                dashboardMostAccessedVideos.innerHTML += `
                    <li>
                        <div class="item-info-row">
                            <img src="${entry.item.metadata.image}" alt="Thumb" class="item-thumbnail" onerror="this.src='https://placehold.co/40?text=No+Preview'">
                            <span class="truncate">${entry.item.metadata.title}:</span> <span class="flex-shrink-0">${entry.count} ${window.translations[currentLanguage]['accesses']}</span>
                        </div>
                        <button class="copy-id-btn" data-video-id="${videoId || entry.item.url}" title="${window.translations[currentLanguage]['copyIdBtn']}">
                            ${window.translations[currentLanguage]['copyIdBtn']}
                        </button>
                    </li>`;
            });
        } else {
            dashboardMostAccessedVideos.innerHTML = `<li><span>${window.translations[currentLanguage]['dataPlaceholder']}</span></li>`;
        }

        // Adiciona event listeners para os botões "Copiar ID" recém-criados no dashboard
        document.querySelectorAll('.dashboard-list .copy-id-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const videoIdOrUrl = e.target.dataset.videoId; // Obtém o ID ou URL do atributo data-
                if (videoIdOrUrl) {
                    navigator.clipboard.writeText(videoIdOrUrl) // Copia para a área de transferência
                        .then(() => showCustomModal(`ID/URL copied: ${videoIdOrUrl}`, window.translations[currentLanguage]['okBtn'])) // Mensagem de sucesso
                        .catch(err => {
                            console.error('Failed to copy ID/URL:', err);
                            showCustomModal(window.translations[currentLanguage]['copyFailed'], window.translations[currentLanguage]['okBtn']); // Mensagem de erro
                        });
                    // Opcional: Mudar para a aba "Pastas & Itens Salvos" e preencher a barra de pesquisa
                    showTab('folders-items-tab');
                    searchQueryInput.value = videoIdOrUrl; // Preenche o input de busca
                    searchItems(); // Realiza a busca
                }
            });
        });
    }


    // **Funções Utilitárias:**

    // Função para aplicar o tema (claro/escuro) em todo o aplicativo
    function applyTheme() {
      document.body.className = theme; // Aplica a classe do tema ao corpo
      // Atualiza o texto do botão de alternar tema
      toggleThemeBtn.textContent = `Toggle ${theme === 'light' ? 'Dark' : 'Light'} Theme`;
      localStorage.setItem('theme', theme); // Salva o tema no localStorage
      
      // Atualiza a cor do texto dos títulos principais
      const appTitle = document.querySelector('h1[data-i18n="appTitle"]');
      const settingsTitle = document.querySelector('h2[data-i18n="settingsTitle"]');
      const languageLabel = document.querySelector('label[data-i18n="languageLabel"]');
      const manageTagsTitle = document.querySelector('h3[data-i18n="manageTagsTitle"]');
      const addNewItemTitle = document.querySelector('#create-save-tab h2[data-i18n="addNewItemTitle"]');
      const createNewFolderTitle = document.querySelector('#create-save-tab h2[data-i18n="createNewFolderTitle"]');
      const foldersTitle = document.querySelector('#folders-items-tab h2 span[data-i18n="foldersTitle"]'); // Adjusted selector
      const searchItemsTitle = document.querySelector('#folders-items-tab h2[data-i18n="searchItemsTitle"]');
      const savedItemsTitle = document.querySelector('#folders-items-tab h2[data-i18n="savedItemsTitle"]');
      const dashboardTitle = document.querySelector('#dashboard-tab h2[data-i18n="dashboardTitle"]');
      const dashboardContent = document.querySelector('#dashboard-tab p[data-i18n="dashboardContent"]');

      const textElements = [
        appTitle, settingsTitle, languageLabel, manageTagsTitle,
        addNewItemTitle, createNewFolderTitle, foldersTitle,
        searchItemsTitle, savedItemsTitle, dashboardTitle, dashboardContent
      ];

      textElements.forEach(element => {
        if (element) {
          if (theme === 'light') {
            element.classList.remove('text-white'); // Remove classe de texto branco
            element.classList.add('text-gray-800'); // Adiciona classe de texto cinza escuro
          } else {
            element.classList.remove('text-gray-800'); // Remove classe de texto cinza escuro
            element.classList.add('text-white'); // Adiciona classe de texto branco
          }
        }
      });

      // Atualiza o fundo e cores do contêiner de pré-visualização
      const previewContainer = document.getElementById('preview-container');
      const previewTitle = document.getElementById('preview-title');
      const previewDescription = document.getElementById('preview-description');

      if (previewContainer) {
        if (theme === 'light') {
          previewContainer.classList.remove('bg-white/10');
          previewContainer.classList.add('bg-white/40');
          previewTitle.classList.remove('text-white');
          previewTitle.classList.add('text-gray-800');
          previewDescription.classList.remove('text-gray-200');
          previewDescription.classList.add('text-gray-600');
        } else {
          previewContainer.classList.remove('bg-white/40');
          previewContainer.classList.add('bg-white/10');
          previewTitle.classList.remove('text-gray-800');
          previewTitle.classList.add('text-white');
          previewDescription.classList.remove('text-gray-600');
          previewDescription.classList.add('text-gray-200');
        }
      }

      // Atualiza as cores do conteúdo dos modais
      const modalContents = document.querySelectorAll('.modal-content');
      modalContents.forEach(modal => {
        const labels = modal.querySelectorAll('.modal-input-group label');
        const inputs = modal.querySelectorAll('.modal-input-group input, .modal-input-group select');
        const closeBtn = modal.querySelector('.modal-close-btn');

        if (modal.id === 'video-player-modal' ) { // Estilo especial para o modal do player
             // O modal do player tem um tratamento de cores diferente (sempre escuro)
             // Então, ele não precisa mudar com o tema light/dark do app, apenas o X
            if (theme === 'light') {
                closeBtn.style.color = 'white'; // Sempre branco contra fundo preto do player
                closeBtn.onmouseover = () => closeBtn.style.backgroundColor = 'rgba(255,255,255,0.2)';
                closeBtn.onmouseout = () => closeBtn.style.backgroundColor = 'rgba(0,0,0,0.5)';
            } else { // Dark theme
                closeBtn.style.color = 'white'; // Sempre branco contra fundo preto do player
                closeBtn.onmouseover = () => closeBtn.style.backgroundColor = 'rgba(255,255,255,0.2)';
                closeBtn.onmouseout = () => closeBtn.style.backgroundColor = 'rgba(0,0,0,0.5)';
            }
        }
        else if (theme === 'light') { // Para outros modais
            modal.style.backgroundColor = '#fff';
            modal.style.color = '#333';
            modal.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.3)';
            closeBtn.style.color = '#888';
            closeBtn.onmouseover = () => closeBtn.style.color = '#333';
            closeBtn.onmouseout = () => closeBtn.style.color = '#888';

            labels.forEach(label => label.style.color = '#333');
            inputs.forEach(input => {
                input.style.backgroundColor = '#f0f0f0';
                input.style.borderColor = '#ddd';
                input.style.color = '#333';
            });
        } else { // Dark theme
            modal.style.backgroundColor = '#2a2a2a';
            modal.style.color = '#e0e7ff';
            modal.style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.6)';
            closeBtn.style.color = '#bbb';
            closeBtn.onmouseover = () => closeBtn.style.color = '#fff';
            closeBtn.onmouseout = () => closeBtn.style.color = '#bbb';

            labels.forEach(label => label.style.color = '#e0e7ff');
            inputs.forEach(input => {
                input.style.backgroundColor = '#3a3a3a';
                input.style.borderColor = '#555';
                input.style.color = '#e0e7ff';
            });
        }
      });
      // Atualiza fundo e cor do texto dos itens de tag
      document.querySelectorAll('.tag-item').forEach(tagItem => {
          if (theme === 'light') {
              tagItem.style.backgroundColor = 'rgba(255, 255, 255, 0.4)';
              tagItem.style.color = '#333';
          } else {
              tagItem.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
              tagItem.style.color = 'white';
          }
      });
      // Atualiza o filtro de cor para ícones SVG
      document.querySelectorAll('.icon-svg').forEach(icon => {
          if (theme === 'light') {
              icon.style.filter = 'invert(0)'; // Sem inversão
          } else {
              icon.style.filter = 'invert(1)'; // Inverte a cor
          }
      });

      // Atualiza as cores dos cards do dashboard
      document.querySelectorAll('.dashboard-card').forEach(card => {
          if (theme === 'light') {
              card.style.backgroundColor = 'rgba(255, 255, 255, 0.6)';
              card.style.borderColor = 'rgba(255, 255, 255, 0.7)';
              card.style.boxShadow = '0 4px 10px rgba(0,0,0,0.05)';
              card.style.color = '#333';
              card.querySelector('h3').style.color = '#007bff';
          } else {
              card.style.backgroundColor = 'rgba(0, 0, 0, 0.2)';
              card.style.borderColor = 'rgba(255, 255, 255, 0.08)';
              card.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.4)';
              card.style.color = '#e0e7ff';
              card.querySelector('h3').style.color = '#4ecdc4';
          }
      });
    }

    // Função para aplicar o idioma selecionado em toda a interface
    function applyLanguage(lang) {
      currentLanguage = lang; // Define o idioma atual
      localStorage.setItem('language', currentLanguage); // Salva o idioma no localStorage

      // Atualiza o texto de todos os elementos com o atributo 'data-i18n'
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n'); // Obtém a chave de tradução
        // Verifica se a tradução existe e aplica
        if (window.translations[currentLanguage] && window.translations[currentLanguage][key]) {
          element.textContent = window.translations[currentLanguage][key];
        }
      });

      // Atualiza o placeholder de todos os elementos com o atributo 'data-i18n-placeholder'
      document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (window.translations[currentLanguage] && window.translations[currentLanguage][key]) {
          element.placeholder = window.translations[currentLanguage][key];
        }
      });

      // Caso especial para o texto do botão de alternar tema
      toggleThemeBtn.textContent = window.translations[currentLanguage]['toggleDarkThemeBtn'];
      
      // NEW: Update toggle folders button text
      toggleFoldersBtn.textContent = foldersListContainer.classList.contains('hidden') 
          ? window.translations[currentLanguage]['expandFoldersBtn']
          : window.translations[currentLanguage]['collapseFoldersBtn'];


      // Re-renderiza conteúdos dinâmicos que usam traduções (para garantir que estejam no idioma correto)
      updateFolderSelects();
      updateSavedTagsList();
      renderItems(items);
      updateDashboard(); // Atualiza o dashboard com o novo idioma
    }

    // Função para atualizar as opções de pastas nos selects e renderizar a lista de pastas
    function updateFolderSelects() {
      // Função auxiliar para criar um elemento <option> com um ícone SVG
      const createOptionWithSVG = (value, textKey, iconPath) => {
        const option = document.createElement('option');
        option.value = value;
        option.setAttribute('data-i18n', textKey);
        // Usa innerHTML para incluir a tag <img> do SVG e o texto traduzido
        option.innerHTML = `<img src="${iconPath}" alt="" class="icon-svg inline-block"> ${window.translations[currentLanguage][textKey]}`;
        return option;
      };

      // Lista de opções de ícones de pastas (caminhos e chaves de tradução)
      const folderIconOptions = [
        { value: "svg/tiktok.svg", textKey: "iconTikTok" },
        { value: "svg/kwai.svg", textKey: "iconKwai" },
        { value: "svg/facebook.svg", textKey: "iconFacebook" },
        { value: "svg/instagram.svg", textKey: "iconInstagram" },
        { value: "svg/youtube.svg", textKey: "iconYouTube" },
        { value: "svg/dailymotion.svg", textKey: "iconDailymotion" },
        { value: "svg/folder.svg", textKey: "iconFolder" },
        { value: "svg/link.svg", textKey: "iconLink" }
      ];

      // Atualiza o select de pasta na seção "Adicionar Novo Item"
      itemFolderSelect.innerHTML = ''; // Limpa as opções existentes
      folders.forEach(folder => {
        const option = document.createElement('option');
        option.value = folder.name;
        option.innerHTML = `<img src="${folder.icon}" alt="" class="icon-svg inline-block"> ${folder.name}`;
        itemFolderSelect.appendChild(option);
      });
      
      // Atualiza o select de pasta na seção "Buscar Itens"
      searchFolderSelect.innerHTML = `<option value="all" data-i18n="allFolders">${window.translations[currentLanguage]['allFolders']}</option>`;
      folders.forEach(folder => {
        const option = document.createElement('option');
        option.value = folder.name;
        option.innerHTML = `<img src="${folder.icon}" alt="" class="icon-svg inline-block"> ${folder.name}`;
        searchFolderSelect.appendChild(option);
      });
      
      // Atualiza o select de pasta no modal "Editar Item"
      editItemFolderSelect.innerHTML = `<option value="">${window.translations[currentLanguage]['noFolder']}</option>`;
      folders.forEach(folder => {
        const option = document.createElement('option');
        option.value = folder.name;
        option.innerHTML = `<img src="${folder.icon}" alt="" class="icon-svg inline-block"> ${folder.name}`;
        editItemFolderSelect.appendChild(option);
      });
      
      // Atualiza a lista de botões de pastas na seção "Pastas"
      foldersList.innerHTML = `<button id="all-items-btn" class="px-2 sm:px-3 py-1 sm:py-2 bg-gradient-to-r from-gray-600 to-gray-800 rounded-lg text-white font-semibold hover:from-gray-700 hover:to-gray-900" data-i18n="allItemsBtn">${window.translations[currentLanguage]['allItemsBtn']}</button>`;
      folders.forEach(folder => {
          // Conta quantos itens estão em cada pasta
          const itemCount = items.filter(item => item.folder === folder.name).length;
          const folderButtonHtml = `
              <div class="flex items-center gap-1 relative">
                  <button class="folder-btn px-2 sm:px-3 py-1 sm:py-2 ${folder.color} rounded-lg text-white font-semibold hover:filter hover:brightness-110" data-folder="${folder.name}">
                      <img src="${folder.icon}" alt="" class="icon-svg inline-block"> ${folder.name} (${itemCount} ${window.translations[currentLanguage]['itemsInFolder']})
                  </button>
                  <button class="edit-folder-btn folder-action-btn edit" data-folder-name="${folder.name}" data-i18n="editBtn">${window.translations[currentLanguage]['editBtn']}</button>
              </div>`;
          foldersList.innerHTML += folderButtonHtml;
      });

      localStorage.setItem('folders', JSON.stringify(folders)); // Salva as pastas no localStorage

      // **FIX:** Adiciona event listeners (onclick) aos botões de pasta e "Todos os Itens"
      // Isso é crucial para que o filtro de pastas funcione corretamente após a renderização dinâmica da lista de pastas.
      document.querySelectorAll('.folder-btn').forEach(btn => {
        btn.onclick = () => { // Usa onclick para simplicidade após a criação dinâmica
          selectedFolder = btn.dataset.folder; // Define a pasta selecionada para filtragem
          searchItems(); // Re-executa a busca para filtrar itens pela pasta
        };
      });
      const allItemsButtonElement = document.getElementById('all-items-btn');
      if (allItemsButtonElement) { 
        allItemsButtonElement.onclick = () => { // Usa onclick
            selectedFolder = null; // Reseta a seleção de pasta para mostrar "todos"
            searchItems(); // Re-executa a busca
        };
      }

      // Adiciona event listeners para os botões de edição de pasta (dentro da lista de pastas)
      foldersList.addEventListener('click', (e) => {
        if (e.target.classList.contains('edit-folder-btn')) {
          e.preventDefault(); // Evita o comportamento padrão do botão
          const folderName = e.target.dataset.folderName; // Obtém o nome da pasta a ser editada
          currentEditingFolder = folders.find(f => f.name === folderName); // Encontra o objeto da pasta nos dados
          if (currentEditingFolder) {
            // Preenche o modal de edição de pasta com os dados da pasta
            editFolderNameInput.value = currentEditingFolder.name;
            editFolderColorSelect.value = currentEditingFolder.color;
            editFolderIconSelect.value = currentEditingFolder.icon;
            editFolderModal.classList.remove('hidden'); // Mostra o modal
          }
        }
      });

      // Popula as opções de ícone nos selects de ícone de pasta (para adicionar e editar)
      folderIconSelect.innerHTML = ''; // Limpa as opções existentes
      editFolderIconSelect.innerHTML = ''; // Limpa as opções existentes
      folderIconOptions.forEach(optionData => {
        folderIconSelect.appendChild(createOptionWithSVG(optionData.value, optionData.textKey, optionData.value));
        editFolderIconSelect.appendChild(createOptionWithSVG(optionData.value, optionData.textKey, optionData.value));
      });
      applyTheme(); // Reaplica o tema para garantir que os novos ícones tenham o filtro correto
    }

    // Função para atualizar a lista de tags salvas e os datalists de tags para autocompletar
    function updateSavedTagsList() {
        tagsList.innerHTML = ''; // Limpa a lista visual de tags
        savedTagsDatalist.innerHTML = ''; // Limpa o datalist para autocompletar ao adicionar item
        savedTagsDatalistSearch.innerHTML = ''; // Limpa o datalist para autocompletar na busca

        savedTags.forEach(tag => {
            // Cria o elemento visual para cada tag (com botões de editar/excluir)
            const tagElement = document.createElement('div');
            tagElement.classList.add('tag-item');
            tagElement.innerHTML = `
                <span>${tag}</span>
                <div class="tag-item-buttons">
                    <button class="edit-tag-btn edit" data-tag="${tag}" data-i18n="editBtn">${window.translations[currentLanguage]['editBtn']}</button>
                    <button class="delete-tag-btn delete" data-tag="${tag}" data-i18n="deleteBtn">${window.translations[currentLanguage]['deleteBtn']}</button>
                </div>
            `;
            tagsList.appendChild(tagElement); // Adiciona à lista visual

            // Adiciona a tag aos datalists para sugestões de autocompletar
            const option = document.createElement('option');
            option.value = tag;
            savedTagsDatalist.appendChild(option);

            const searchOption = document.createElement('option');
            searchOption.value = tag;
            savedTagsDatalistSearch.appendChild(searchOption);
        });
        localStorage.setItem('savedTags', JSON.stringify(savedTags)); // Salva as tags no localStorage
        applyTheme(); // Reaplica o tema para garantir cores corretas
    }

    // Event listener para o botão "Adicionar Tag"
    addTagBtn.addEventListener('click', () => {
        const newTag = newTagInput.value.trim(); // Obtém o valor do input, remove espaços
        // Verifica se a tag não está vazia e se já não existe
        if (newTag && !savedTags.includes(newTag)) {
            savedTags.push(newTag); // Adiciona a nova tag
            newTagInput.value = ''; // Limpa o input
            updateSavedTagsList(); // Atualiza a lista visual de tags
        } else if (newTag) {
            // Mensagem se a tag já existe
            showCustomModal(window.translations[currentLanguage]['folderAlreadyExists'](newTag));
        } else {
            // Mensagem se o input está vazio
            showCustomModal(window.translations[currentLanguage]['newTagPlaceholder']);
        }
    });

    // Event listener para edição e exclusão de tags na lista de tags
    tagsList.addEventListener('click', (e) => {
        // Se o botão clicado tem a classe 'edit-tag-btn'
        if (e.target.classList.contains('edit-tag-btn')) {
            const tagToEdit = e.target.dataset.tag; // Obtém a tag a ser editada
            currentEditingTag = tagToEdit; // Armazena a tag atual para edição
            editTagNameInput.value = tagToEdit; // Preenche o input do modal de edição
            editTagModal.classList.remove('hidden'); // Mostra o modal de edição
        } 
        // Se o botão clicado tem a classe 'delete-tag-btn'
        else if (e.target.classList.contains('delete-tag-btn')) {
            const tagToDelete = e.target.dataset.tag; // Obtém a tag a ser excluída
            // Pede confirmação antes de excluir
            showConfirmModal(`Tem certeza de que deseja excluir a tag "${tagToDelete}"? Esta tag será removida de todos os links que a utilizam.`, () => {
                // Filtra a tag da lista de tags salvas
                savedTags = savedTags.filter(tag => tag !== tagToDelete);
                // Remove a tag de todos os itens que a utilizam
                items = items.map(item => {
                    if (item.tags && item.tags.includes(tagToDelete)) {
                        return { ...item, tags: item.tags.filter(t => t !== tagToDelete) };
                    }
                    return item;
                });
                localStorage.setItem('items', JSON.stringify(items)); // Salva os itens atualizados
                updateSavedTagsList(); // Atualiza a lista visual de tags
                renderItems(); // Re-renderiza os itens (para refletir a remoção da tag)
            }, window.translations[currentLanguage]['yesBtn'], window.translations[currentLanguage]['noBtn']);
        }
    });

    // Event listener para salvar alterações de tag no modal de edição
    saveTagChangesBtn.addEventListener('click', () => {
        const oldTag = currentEditingTag; // Tag original
        const newTag = editTagNameInput.value.trim(); // Novo nome da tag

        // Validações
        if (newTag && newTag !== oldTag && savedTags.includes(newTag)) {
            showCustomModal(window.translations[currentLanguage]['folderAlreadyExists'](newTag));
            return;
        }
        if (!newTag) {
            showCustomModal(window.translations[currentLanguage]['newTagPlaceholder']);
            return;
        }

        // Atualiza o nome da tag em savedTags e em todos os itens que a utilizam
        savedTags = savedTags.map(tag => tag === oldTag ? newTag : tag);
        items = items.map(item => {
            if (item.tags) {
                return { ...item, tags: item.tags.map(tag => tag === oldTag ? newTag : tag) };
            }
            return item;
        });

        localStorage.setItem('items', JSON.stringify(items)); // Salva os itens atualizados
        updateSavedTagsList(); // Atualiza a lista visual de tags
        renderItems(); // Re-renderiza os itens
        editTagModal.classList.add('hidden'); // Oculta o modal
        currentEditingTag = null; // Reseta a tag em edição
    });

    // Event listener para salvar alterações de pasta no modal de edição de pasta
    saveFolderChangesBtn.addEventListener('click', () => {
      if (currentEditingFolder) {
        const oldFolderName = currentEditingFolder.name;
        const newFolderName = editFolderNameInput.value.trim();
        const newFolderColor = editFolderColorSelect.value;
        const newFolderIcon = editFolderIconSelect.value;

        // Validações
        if (newFolderName && newFolderName !== oldFolderName && folders.some(f => f.name === newFolderName)) {
            showCustomModal(window.translations[currentLanguage]['folderAlreadyExists'](newFolderName));
            return;
        }
        if (!newFolderName) {
            showCustomModal(window.translations[currentLanguage]['folderNameEmpty']);
            return;
        }

        // Atualiza as propriedades da pasta
        currentEditingFolder.name = newFolderName;
        currentEditingFolder.color = newFolderColor;
        currentEditingFolder.icon = newFolderIcon;

        // Se o nome da pasta mudou, atualiza todos os itens que a referenciam
        if (oldFolderName !== newFolderName) {
          items = items.map(item => {
            if (item.folder === oldFolderName) {
              return { ...item, folder: newFolderName };
            }
            return item;
          });
        }
        localStorage.setItem('folders', JSON.stringify(folders)); // Salva as pastas
        localStorage.setItem('items', JSON.stringify(items)); // Salva os itens
        updateFolderSelects(); // Atualiza os selects de pasta e a lista de botões
        searchItems(); // Re-renderiza os itens
        editFolderModal.classList.add('hidden'); // Oculta o modal
        currentEditingFolder = null; // Reseta a pasta em edição
      }
    });

    // Event listener para excluir pasta no modal de edição de pasta
    deleteFolderFromModalBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (currentEditingFolder) {
            const folderName = currentEditingFolder.name;
            const linksInFolder = items.filter(item => item.folder === folderName).length;
            
            // Pede confirmação para exclusão, informando sobre os links na pasta
            showConfirmModal(window.translations[currentLanguage]['confirmDeleteFolder'](folderName, linksInFolder), () => {
                // Remove a pasta da lista de pastas
                folders = folders.filter(f => f.name !== folderName);
                // Move os links da pasta excluída para "All Items" (folder: null)
                items = items.map(item => {
                    if (item.folder === folderName) {
                        return { ...item, folder: null };
                    }
                    return item;
                });
                localStorage.setItem('items', JSON.stringify(items)); // Salva os itens
                localStorage.setItem('folders', JSON.stringify(folders)); // Salva as pastas
                updateFolderSelects(); // Atualiza os selects de pasta e a lista de botões
                searchItems(); // Re-renderiza os itens
                editFolderModal.classList.add('hidden'); // Oculta o modal
                currentEditingFolder = null; // Reseta a pasta em edição
            }, window.translations[currentLanguage]['yesBtn'], window.translations[currentLanguage]['noBtn']);
        }
    });

    // Função para buscar metadados de uma URL (título, descrição, imagem)
    // Isso ajuda a popular a pré-visualização e os cards de itens
    async function fetchMetadata(url) {
      try {
        // Tenta extrair ID e informações para YouTube
        const youtubeVideoId = getYouTubeVideoId(url);
        if (youtubeVideoId) {
            return {
                title: `${window.translations[currentLanguage]['youtubeVideoPrefix']}: ${youtubeVideoId}`,
                description: window.translations[currentLanguage]['youtubeVideoDescription'],
                image: `https://img.youtube.com/vi/${youtubeVideoId}/sddefault.jpg` // URL de thumbnail do YouTube
            };
        }

        // Tenta extrair ID e informações para Dailymotion
        const dailymotionRegex = /(?:dailymotion\.com\/(?:video|embed)\/|dai\.ly\/)([a-zA-Z0-9]+)/;
        const dailymotionMatch = url.match(dailymotionRegex);
        if (dailymotionMatch && dailymotionMatch[1]) {
            const dailymotionVideoId = dailymotionMatch[1];
            return {
                title: `${window.translations[currentLanguage]['dailymotionVideoPrefix']}: ${dailymotionVideoId}`,
                description: window.translations[currentLanguage]['dailymotionVideoDescription'],
                image: `https://www.dailymotion.com/thumbnail/video/${dailymotionVideoId}`
            };
        }

        // Tenta extrair ID e informações para TikTok
        if (url.includes('tiktok.com')) {
          const tiktokRegex = /(?:tiktok\.com\/@(?:[a-zA-Z0-9_]+\/video|v)\/)([0-9]+)/;
          const tiktokMatch = tiktokRegex.exec(url);
          const tiktokVideoId = tiktokMatch ? tiktokMatch[1] : 'Unknown';
          return {
            title: `${window.translations[currentLanguage]['tiktokVideoPrefix']}: ${tiktokVideoId}`,
            description: `${window.translations[currentLanguage]['tiktokVideoDescription']}`,
            image: `https://placehold.co/200x150?text=TikTok+Video` // Placeholder para TikTok
          };
        }

        // Tenta extrair ID e informações para Kwai
        if (url.includes('kwai.com')) {
          const kwaiRegex = /(?:kwai\.com\/(?:photo|video)\/)([0-9]+)/;
          const kwaiMatch = kwaiRegex.exec(url);
          const kwaiContentId = kwaiMatch ? kwaiMatch[1] : 'Unknown';
          return {
            title: `${window.translations[currentLanguage]['kwaiVideoPrefix']}: ${kwaiContentId}`,
            description: `${window.translations[currentLanguage]['kwaiVideoDescription']}`,
            image: `https://placehold.co/200x150?text=Kwai+Content` // Placeholder para Kwai
          };
        }

        // Para Facebook (geralmente difícil de obter metadados sem API)
        if (url.includes('facebook.com')) {
            return {
                title: `${window.translations[currentLanguage]['facebookLinkPrefix']}`,
                description: `${window.translations[currentLanguage]['facebookLinkDescription']}`,
                image: `https://placehold.co/200x150?text=Facebook+Link` // Placeholder para Facebook
            };
        }

        // Para Instagram (geralmente difícil de obter metadados sem API)
        if (url.includes('instagram.com')) {
          return {
            title: `${window.translations[currentLanguage]['instagramLinkPrefix']}`,
            description: `${window.translations[currentLanguage]['instagramLinkDescription']}`,
            image: `https://placehold.co/200x150?text=Instagram+Content` // Placeholder para Instagram
          };
        }

        // Metadados genéricos para outros links
        const urlObj = new URL(url);
        const displayUrl = urlObj.hostname.replace('www.', ''); // Obtém o domínio
        const pathSegments = urlObj.pathname.split('/').filter(segment => segment.length > 0);
        let dynamicTitle = `${window.translations[currentLanguage]['genericLinkPrefix']}: ${displayUrl}`;
        if (pathSegments.length > 0) {
            dynamicTitle = `${window.translations[currentLanguage]['genericLinkPrefix']}: ${pathSegments[pathSegments.length - 1].replace(/[-_]/g, ' ')}`;
            dynamicTitle = dynamicTitle.charAt(0).toUpperCase() + dynamicTitle.slice(1);
        }

        return {
          title: dynamicTitle,
          description: `${window.translations[currentLanguage]['genericContentFrom']} ${displayUrl}. (${window.translations[currentLanguage]['noMetadataAvailable']})`,
          image: `https://placehold.co/200x150?text=No+Preview` // Imagem de placeholder
        };
      } catch (error) {
        console.error('Failed to generate metadata placeholder:', error);
        return { title: url, description: window.translations[currentLanguage]['noMetadataAvailable'], image: `https://placehold.co/200x150?text=No+Preview` };
      }
    }

    // Função para obter o ID de um vídeo do YouTube a partir da URL
    function getYouTubeVideoId(url) {
        const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i;
        const match = url.match(regex);
        return match ? match[1] : null;
    }

    // Função para atualizar a pré-visualização ao adicionar um novo item
    async function updatePreview(url) {
      if (url.trim()) {
        previewContainer.classList.remove('hidden'); // Mostra o contêiner de preview
        previewImage.src = ''; // Limpa a imagem anterior
        previewTitle.textContent = window.translations[currentLanguage]['loadingPreview']; // Exibe mensagem de carregamento
        previewDescription.textContent = window.translations[currentLanguage]['fetchingPreview']; // Exibe mensagem de busca

        const metadata = await fetchMetadata(url); // Busca os metadados da URL
        previewImage.src = metadata.image; // Define a imagem do preview
        previewTitle.textContent = metadata.title; // Define o título do preview
        previewDescription.textContent = metadata.description; // Define a descrição do preview
        previewImage.onerror = function() {
            // Fallback se a imagem não carregar
            this.src = `https://placehold.co/80?text=${window.translations[currentLanguage]['noPreview'].replace(/ /g, '+')}`;
        };
      } else {
        previewContainer.classList.add('hidden'); // Oculta o contêiner de preview se a URL estiver vazia
      }
    }

    // Função para renderizar a lista de itens salvos (ou itens filtrados)
    async function renderItems(filteredItems = items) {
      itemsList.innerHTML = ''; // Limpa a lista existente
      if (filteredItems.length === 0) {
        itemsList.innerHTML = `<p class="text-gray-200">${window.translations[currentLanguage]['noItemsFound']}</p>`;
        return;
      }

      for (const item of filteredItems) {
        // Encontra a pasta do item ou usa uma pasta padrão se não tiver
        const folder = folders.find(f => f.name === item.folder) || { color: 'bg-gray-500', icon: 'svg/folder.svg', name: window.translations[currentLanguage]['noFolder'] };
        
        // Se os metadados estiverem faltando ou forem placeholder, tenta buscá-los novamente
        if (!item.metadata || !item.metadata.title || (item.metadata.image && item.metadata.image.includes('placehold.co'))) {
          item.metadata = await fetchMetadata(item.url);
          localStorage.setItem('items', JSON.stringify(items)); // Salva itens atualizados
        }
        const { title, description, image } = item.metadata;
        const addedDate = item.timestamp ? new Date(item.timestamp).toLocaleString(currentLanguage) : '';

        // Gera o HTML para a exibição de estrelas (avaliação)
        let starsHtml = '<div class="display-rating">';
        for (let i = 1; i <= 5; i++) {
            starsHtml += `<span class="star${item.rating >= i ? '' : '-empty'}">★</span>`;
        }
        starsHtml += '</div>';

        // Lógica para determinar o elemento clicável: player de vídeo ou link externo
        let clickableElement;
        if (item.type === 'video') {
            // Para vídeos, o clique abrirá o modal de reprodutor interno
            clickableElement = `
                <div class="flex flex-col items-center text-center w-full flex-grow cursor-pointer" data-item-id="${item.id}" data-url="${item.url}" data-item-type="${item.type}" onclick="openVideoPlayer('${item.url}', '${item.type}', ${item.id})">
                    <img src="${image}" alt="Preview" class="item-thumbnail-img" onerror="this.src='https://placehold.co/200x150?text=${window.translations[currentLanguage]['noPreview'].replace(/ /g, '+')}'">
                    <div class="w-full mt-3 flex-grow flex flex-col justify-center">
                        <div class="item-title truncate-lines-2 leading-tight">${title}</div>
                        <p class="item-url-short">${item.url.replace(/^(https?:\/\/)?(www\.)?/i, '').split('/')[0]}</p>
                        <p class="item-added-date">${addedDate}</p>
                    </div>
                </div>`;
        } else {
            // Para outros tipos, o clique abrirá em uma nova aba/janela do navegador
            clickableElement = `
                <a href="${item.url}" target="_blank" class="flex flex-col items-center text-center w-full flex-grow no-underline ${theme === 'light' ? 'text-gray-800' : 'text-white'}" data-item-id="${item.id}">
                    <img src="${image}" alt="Preview" class="item-thumbnail-img" onerror="this.src='https://placehold.co/200x150?text=${window.translations[currentLanguage]['noPreview'].replace(/ /g, '+')}'">
                    <div class="w-full mt-3 flex-grow flex flex-col justify-center">
                        <div class="item-title truncate-lines-2 leading-tight">${title}</div>
                        <p class="item-url-short">${item.url.replace(/^(https?:\/\/)?(www\.)?/i, '').split('/')[0]}</p>
                        <p class="item-added-date">${addedDate}</p>
                    </div>
                </a>`;
        }

        const itemHtml = `
          <div class="glass-effect p-3 sm:p-4 rounded-xl hover:shadow-xl transition-all flex flex-col items-center justify-between h-full" style="border-color: ${folder.color.replace('bg-', '#').replace('-500', '50').replace('-600', '60').replace('black', '000')};">
            ${clickableElement}
            <div class="flex flex-wrap items-center justify-center gap-1 sm:gap-2 mt-4 pt-4 border-t border-white/10 w-full item-actions-bottom">
              <span class="inline-block w-3 h-3 sm:w-4 sm:h-4 ${folder.color} rounded-full"></span>
              ${starsHtml} 
              <button class="copy-btn px-2 sm:px-3 py-1 bg-gradient-to-r from-green-600 to-green-700 rounded-lg text-white text-sm hover:from-green-700 hover:to-green-800" data-url="${item.url}" data-i18n="copyBtn">${window.translations[currentLanguage]['copyBtn']}</button>
              <button class="edit-item-btn px-2 sm:px-3 py-1 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg text-white text-sm hover:from-blue-700 hover:to-blue-800" data-id="${item.id}" data-i18n="editBtn">${window.translations[currentLanguage]['editBtn']}</button>
              <button class="delete-btn px-2 sm:px-3 py-1 bg-gradient-to-r from-red-500 to-red-700 rounded-lg text-white text-sm hover:from-red-600 hover:to-red-800" data-id="${item.id}" data-i18n="deleteBtn">${window.translations[currentLanguage]['deleteBtn']}</button>
            </div>
          </div>
        `;
        itemsList.innerHTML += itemHtml; // Adiciona o item renderizado à lista
      }
      applyTheme(); // Reaplica o tema para garantir cores corretas
    }

    // **Funções do Reprodutor de Vídeo:**

    // Função para abrir o modal do reprodutor de vídeo e carregar o vídeo
    function openVideoPlayer(url, type, itemId) {
        let embedUrl = ''; // Variável para armazenar a URL de incorporação (embed)

        // Lógica para construir a URL de incorporação correta com base no tipo e plataforma do vídeo
        if (type === 'video') { // Verifica se é um item do tipo "vídeo"
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const videoId = getVideoIdFromUrl(url, 'youtube');
                if (videoId) embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1`;
            } else if (url.includes('dailymotion.com') || url.includes('dai.ly')) {
                const videoId = getVideoIdFromUrl(url, 'dailymotion');
                if (videoId) embedUrl = `https://www.dailymotion.com/embed/video/${videoId}?autoplay=1`;
            } else if (url.includes('tiktok.com')) {
                const videoId = getVideoIdFromUrl(url, 'tiktok');
                // Embeds do TikTok podem ser complexos e exigir um script adicional ou ser bloqueados.
                // Esta URL é uma tentativa de embed direto, mas pode não funcionar universalmente.
                // Para maior compatibilidade em executáveis, pode ser necessário um player customizado ou abrir em nova aba.
                if (videoId) embedUrl = `https://www.tiktok.com/embed/v2/${videoId}`; 
            } else if (url.includes('kwai.com')) {
                const videoId = getVideoIdFromUrl(url, 'kwai');
                // Embeds do Kwai são mais restritivos. Abrir em nova aba pode ser a melhor opção.
                if (videoId) embedUrl = `https://m.kwai.com/photo/${videoId}/embed`; // Tentativa de embed
            } else if (url.includes('facebook.com')) {
                // Facebook é o mais problemático para embedar sem o SDK ou permissões específicas.
                // Geralmente, abrir em uma nova aba é a solução mais confiável.
                window.open(url, '_blank'); // Abre a URL original em uma nova aba
                // Registra o acesso mesmo que abra externamente
                const item = items.find(i => i.id === itemId);
                if (item) {
                    if (!item.accessHistory) item.accessHistory = [];
                    item.accessHistory.push(Date.now());
                    localStorage.setItem('items', JSON.stringify(items));
                }
                return; // Sai da função, não tenta incorporar no iframe
            }
        }

        // Se uma URL de incorporação válida foi gerada, injeta o iframe no modal
        if (embedUrl) {
            videoPlayerIframeContainer.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
            videoPlayerModal.classList.remove('hidden'); // Mostra o modal do reprodutor
            
            // Atualiza o histórico de acesso do item (cliques)
            const item = items.find(i => i.id === itemId);
            if (item) {
                if (!item.accessHistory) {
                    item.accessHistory = [];
                }
                item.accessHistory.push(Date.now());
                localStorage.setItem('items', JSON.stringify(items)); // Salva os itens com o novo acesso
            }
        } else {
             // Fallback: Se a URL não puder ser incorporada ou for de um tipo não suportado no iframe, abre em nova aba.
             // Isso garante que o conteúdo seja acessível de alguma forma.
            window.open(url, '_blank');
            // Registra o acesso mesmo que abra externamente
            const item = items.find(i => i.id === itemId);
            if (item) {
                if (!item.accessHistory) item.accessHistory = [];
                item.accessHistory.push(Date.now());
                localStorage.setItem('items', JSON.stringify(items));
            }
        }
    }

    // Função para fechar o modal do reprodutor de vídeo
    function closeVideoPlayerModal() {
        videoPlayerIframeContainer.innerHTML = ''; // Limpa o conteúdo do iframe (para parar a reprodução e limpar o modal)
        videoPlayerModal.classList.add('hidden'); // Oculta o modal do reprodutor
        updateDashboard(); // Atualiza o dashboard (para refletir novos acessos, se houver)
    }

    // Event listener para o botão "Adicionar Item"
    addItemBtn.addEventListener('click', async () => {
      const url = itemUrlInput.value.trim(); // Obtém a URL do input e remove espaços
      const tags = itemTagsInput.value.trim().split(',').map(tag => tag.trim()).filter(tag => tag); // Processa as tags (separa por vírgula, limpa espaços)
      if (url) { // Se a URL não estiver vazia
        // Verifica se já existe um item com a mesma URL para evitar duplicatas
        const isDuplicate = items.some(item => item.url === url);
        if (isDuplicate) {
            showCustomModal(window.translations[currentLanguage]['folderAlreadyExists'](url));
            return; // Sai da função se for duplicado
        }

        const metadata = await fetchMetadata(url); // Busca metadados (título, imagem, etc.) da URL
        // Adiciona o novo item ao array 'items'
        items.push({
          id: Date.now(), // Gera um ID único baseado no timestamp atual
          url, // URL original do item
          type: itemTypeSelect.value, // Tipo selecionado (link, video, photo)
          folder: itemFolderSelect.value, // Pasta selecionada
          tags: tags.length > 0 ? tags : [], // Tags associadas ao item
          metadata, // Metadados obtidos
          timestamp: Date.now(), // Data/hora de criação do item
          rating: 0, // Avaliação inicial (0 estrelas)
          accessHistory: [] // Histórico de acesso vazio para um novo item
        });
        // Adiciona quaisquer novas tags à lista global de tags salvas, se ainda não existirem
        tags.forEach(tag => {
            if (!savedTags.includes(tag)) {
                savedTags.push(tag);
            }
        });
        localStorage.setItem('savedTags', JSON.stringify(savedTags)); // Salva as tags salvas no localStorage
        localStorage.setItem('items', JSON.stringify(items)); // Salva o array completo de itens no localStorage
        
        // Limpa os campos do formulário e esconde a pré-visualização
        itemUrlInput.value = '';
        itemTagsInput.value = '';
        previewContainer.classList.add('hidden');
        
        // Atualiza a interface do usuário
        updateSavedTagsList(); // Atualiza a lista de tags visíveis e datalists
        renderItems(); // Re-renderiza a lista de itens exibida
        updateFolderSelects(); // Atualiza os selects de pasta e seus contadores
        updateDashboard(); // Atualiza o dashboard com os novos dados
      }
    });

    // Event listener para o botão "Colar Link"
    pasteLinkBtn.addEventListener('click', async () => {
      try {
        const text = await navigator.clipboard.readText(); // Tenta ler o texto da área de transferência
        itemUrlInput.value = text; // Cola o texto no input de URL
        await updatePreview(text); // Atualiza a pré-visualização com o texto colado
      } catch (err) {
        console.error('Paste failed:', err); // Log de erro se a colagem falhar
        showCustomModal(window.translations[currentLanguage]['pasteFailed']); // Exibe mensagem de erro para o usuário
      }
    });

    // Event listener para o botão "Adicionar Pasta"
    addFolderBtn.addEventListener('click', () => {
      const folderName = newFolderInput.value.trim(); // Obtém o nome da nova pasta, removendo espaços
      // Valida se o nome não está vazio e se a pasta com esse nome já não existe
      if (folderName && !folders.some(f => f.name === folderName)) {
        // Adiciona a nova pasta ao array 'folders'
        folders.push({
          name: folderName,
          color: folderColorSelect.value, // Cor selecionada para a pasta
          icon: folderIconSelect.value // Ícone selecionado para a pasta
        });
        updateFolderSelects(); // Atualiza os selects de pasta e a lista de botões de pastas
        newFolderInput.value = ''; // Limpa o input do nome da pasta
        renderItems(); // Re-renderiza a lista de itens (caso a nova pasta afete a visualização ou filtros)
        updateDashboard(); // Atualiza o dashboard com o novo número de pastas
      } else if (folderName) {
        // Mensagem se o nome da pasta já existe
        showCustomModal(window.translations[currentLanguage]['folderAlreadyExists'](folderName));
      } else {
        // Mensagem se o nome da pasta está vazio
        showCustomModal(window.translations[currentLanguage]['folderNameEmpty']);
      }
    });

    // Função para realizar a busca/filtragem de itens na lista principal
    function searchItems() {
      const query = searchQueryInput.value.toLowerCase(); // Termo de busca (URL, título, descrição) em minúsculas
      // Processa as tags de busca: separa por vírgula, limpa espaços e filtra vazios
      const tagsQuery = searchTagsInput.value.toLowerCase().split(',').map(tag => tag.trim()).filter(tag => tag);
      const type = searchTypeSelect.value; // Tipo de item a buscar ('all', 'link', 'video', 'photo')
      const folder = searchFolderSelect.value; // Pasta a buscar ('all' ou nome da pasta)
      const minRating = parseInt(searchRatingSelect.value); // Avaliação mínima a buscar (convertida para inteiro)

      // Filtra o array 'items' com base nos critérios de busca
      const filteredItems = items.filter(item => {
        // Verifica se o item corresponde à query principal (URL, título ou descrição)
        const matchesQuery = query === '' || item.url.toLowerCase().includes(query) || 
                            (item.metadata && item.metadata.title && item.metadata.title.toLowerCase().includes(query)) || // Added check for item.metadata.title
                            (item.metadata && item.metadata.description && item.metadata.description.toLowerCase().includes(query)); // Added check for item.metadata.description
        
        // Verifica se o item possui todas as tags pesquisadas (AND lógico entre as tags da busca)
        const matchesTags = tagsQuery.length === 0 || 
                            (item.tags && item.tags.some(tag => tagsQuery.some(searchTag => tag.toLowerCase().includes(searchTag))));

        // Verifica se o tipo do item corresponde ao tipo selecionado no filtro
        const matchesType = type === 'all' || item.type === type;
        // Verifica se o item pertence à pasta selecionada ou se a busca é por "todas as pastas"
        // selectedFolder é a variável global usada pelos botões de filtro de pasta
        const matchesFolder = (folder === 'all' && (selectedFolder === null || item.folder === selectedFolder)) || 
                              (item.folder === folder);
        
        // Verifica se a avaliação do item é maior ou igual à avaliação mínima selecionada
        const matchesRating = isNaN(minRating) || searchRatingSelect.value === 'all' ||
                              (searchRatingSelect.value === '0' && (item.rating === 0 || item.rating === undefined)) ||
                              (item.rating >= minRating);

        // Retorna true se todos os critérios de busca forem atendidos
        return matchesQuery && matchesTags && matchesType && matchesFolder && matchesRating;
      });
      renderItems(filteredItems); // Renderiza a lista de itens filtrados na interface
    }

    // Adiciona event listeners para os inputs e selects de busca
    searchQueryInput.addEventListener('input', searchItems); // Dispara a busca ao digitar na query
    searchTagsInput.addEventListener('input', searchItems); // Dispara a busca ao digitar tags
    searchTypeSelect.addEventListener('change', searchItems); // Dispara a busca ao mudar o tipo
    searchFolderSelect.addEventListener('change', (e) => {
      selectedFolder = e.target.value === 'all' ? null : e.target.value; // Atualiza a pasta selecionada
      searchItems(); // Realiza a busca
    });
    searchRatingSelect.addEventListener('change', searchItems); // Dispara a busca ao mudar a avaliação

    // Delegação de eventos para botões de copiar, editar e excluir itens na lista principal
    itemsList.addEventListener('click', (e) => {
      // Botão de Excluir Item
      if (e.target.classList.contains('delete-btn')) {
        const id = parseInt(e.target.dataset.id); // Obtém o ID do item a ser excluído
        showConfirmModal(window.translations[currentLanguage]['confirmDeleteItem'], () => {
          items = items.filter(item => item.id !== id); // Remove o item do array 'items'
          localStorage.setItem('items', JSON.stringify(items)); // Salva o array atualizado no localStorage
          renderItems(); // Re-renderiza a lista de itens
          updateFolderSelects(); // Atualiza os contadores de itens nas pastas
          updateDashboard(); // Atualiza as estatísticas do dashboard
        }, window.translations[currentLanguage]['yesBtn'], window.translations[currentLanguage]['noBtn']);
      } 
      // Botão de Copiar URL do Item
      else if (e.target.classList.contains('copy-btn')) {
        const url = e.target.dataset.url; // Obtém a URL do item a ser copiada
        
        try {
            // Tenta usar a API moderna do navegador para copiar para a área de transferência
            navigator.clipboard.writeText(url).then(() => {
                showCustomModal(window.translations[currentLanguage]['urlCopied'], window.translations[currentLanguage]['okBtn']); // Mensagem de sucesso
            }).catch(err => {
                console.error('Failed to copy using navigator.clipboard (promise-based):', err);
                fallbackCopyTextToClipboard(url); // Se a API falhar, tenta o método de fallback
            });
        } catch (err) {
            // Captura erros para navegadores mais antigos ou restrições de segurança
            console.error('Failed to copy using navigator.clipboard (synchronous):', err);
            fallbackCopyTextToClipboard(url); // Tenta o método de fallback
        }
      } 
      // Botão de Editar Item
      else if (e.target.classList.contains('edit-item-btn')) {
        const id = parseInt(e.target.dataset.id); // Obtém o ID do item a ser editado
        currentEditingItem = items.find(item => item.id === id); // Encontra o item correspondente no array
        if (currentEditingItem) {
          // Preenche os campos do modal de edição com os dados do item
          editItemUrlInput.value = currentEditingItem.url;
          editItemTagsInput.value = currentEditingItem.tags.join(', ');
          editItemTypeSelect.value = currentEditingItem.type;
          editItemFolderSelect.value = currentEditingItem.folder || ''; // Define pasta ou string vazia

          // Define a avaliação atual do item nos botões de rádio do modal
          editItemRatingInputs.forEach(radio => {
              radio.checked = parseInt(radio.value) === currentEditingItem.rating;
          });

          editItemModal.classList.remove('hidden'); // Mostra o modal de edição de item
        }
      }
    });

    // Event listener para o botão "Salvar Alterações" no modal de edição de item
    saveItemChangesBtn.addEventListener('click', async () => {
      if (currentEditingItem) { // Verifica se há um item sendo editado
        const newUrl = editItemUrlInput.value.trim(); // Obtém a nova URL
        // Processa as tags: separa por vírgula, limpa espaços, filtra vazias
        const newTags = editItemTagsInput.value.trim().split(',').map(tag => tag.trim()).filter(tag => tag);
        const newType = editItemTypeSelect.value; // Obtém o novo tipo
        const newFolder = editItemFolderSelect.value || null; // Obtém a nova pasta ou null
        
        // Obtém a nova avaliação do item a partir dos botões de rádio
        let newRating = 0;
        editItemRatingInputs.forEach(radio => {
            if (radio.checked) {
                newRating = parseInt(radio.value);
            }
        });

        // Verifica se a nova URL é duplicada, excluindo o próprio item que está sendo editado
        const isDuplicate = items.some(item => item.url === newUrl && item.id !== currentEditingItem.id);
        if (isDuplicate) {
            showCustomModal(window.translations[currentLanguage]['folderAlreadyExists'](newUrl)); // Mensagem de erro para duplicata
            return; // Sai da função
        }

        // Atualiza as propriedades do item atual
        currentEditingItem.url = newUrl;
        currentEditingItem.tags = newTags;
        currentEditingItem.type = newType;
        currentEditingItem.folder = newFolder;
        currentEditingItem.rating = newRating; // Atualiza a avaliação do item
        
        // Se a URL do item foi alterada, busca novos metadados para ela
        if (newUrl !== currentEditingItem.url) {
            currentEditingItem.metadata = await fetchMetadata(newUrl);
        }
        // Adiciona quaisquer novas tags que foram inseridas ao editar o item à lista global de tags salvas
        newTags.forEach(tag => {
            if (!savedTags.includes(tag)) {
                savedTags.push(tag);
            }
        });

        localStorage.setItem('savedTags', JSON.stringify(savedTags)); // Salva as tags salvas no localStorage
        localStorage.setItem('items', JSON.stringify(items)); // Salva o array de itens atualizado
        renderItems(); // Re-renderiza a lista de itens
        editItemModal.classList.add('hidden'); // Oculta o modal de edição
        currentEditingItem = null; // Reseta a variável do item em edição
        updateSavedTagsList(); // Atualiza a lista de tags visíveis
        updateFolderSelects(); // Atualiza os selects de pasta e contadores
        updateDashboard(); // Atualiza o dashboard
      }
    });

    // Função de fallback para copiar texto para a área de transferência (usado quando navigator.clipboard falha)
    function fallbackCopyTextToClipboard(text) {
        const tempInput = document.createElement('textarea'); // Cria um textarea temporário
        tempInput.value = text; // Atribui o texto a ser copiado
        document.body.appendChild(tempInput); // Adiciona o textarea ao DOM
        tempInput.select(); // Seleciona o texto no textarea
        try {
            document.execCommand('copy'); // Tenta executar o comando de cópia (método antigo)
            showCustomModal(window.translations[currentLanguage]['urlCopied'] + ' (Fallback)', window.translations[currentLanguage]['okBtn']); // Mensagem de sucesso
        } catch (err) {
            console.error('Failed to copy using document.execCommand:', err); // Log de erro
            showCustomModal(window.translations[currentLanguage]['copyFailed'], window.translations[currentLanguage]['okBtn']); // Mensagem de erro para o usuário
        } finally {
            document.body.removeChild(tempInput); // Remove o textarea temporário
        }
    }

    // Event listener para o botão "Settings" (alterna a visibilidade do painel de configurações)
    settingsBtn.addEventListener('click', () => {
      settingsPanel.classList.toggle('hidden'); // Adiciona ou remove a classe 'hidden'
    });

    // Event listener para o botão "Toggle Dark Theme"
    toggleThemeBtn.addEventListener('click', () => {
      theme = theme === 'light' ? 'dark' : 'light'; // Inverte o tema atual
      applyTheme(); // Aplica as novas classes de tema e cores
    });

    // Event listener for the "Collapse/Expand Folders" button
    toggleFoldersBtn.addEventListener('click', () => {
        foldersListContainer.classList.toggle('hidden');
        if (foldersListContainer.classList.contains('hidden')) {
            toggleFoldersBtn.textContent = window.translations[currentLanguage]['expandFoldersBtn'];
        } else {
            toggleFoldersBtn.textContent = window.translations[currentLanguage]['collapseFoldersBtn'];
        }
    });

    // Event listener para o botão "Clear All Items"
    clearItemsBtn.addEventListener('click', () => {
      // Exibe um modal de confirmação antes de apagar tudo
      showConfirmModal(window.translations[currentLanguage]['confirmClearAllItems'], () => {
          items = []; // Esvazia o array de itens
          localStorage.setItem('items', JSON.stringify(items)); // Salva o array vazio no localStorage
          renderItems(); // Re-renderiza a lista de itens (agora vazia)
          updateFolderSelects(); // Atualiza contadores de itens nas pastas
          updateDashboard(); // Atualiza as estatísticas do dashboard
      }, window.translations[currentLanguage]['yesBtn'], window.translations[currentLanguage]['noBtn']);
    });

    // Event listener para o botão "Manage Data" (abre o modal de gerenciamento de dados)
    manageDataBtn.addEventListener('click', () => {
      manageDataModal.classList.remove('hidden'); // Remove a classe 'hidden' para mostrar o modal
    });

    // Event listener para o botão "Exportar Dados" dentro do modal de gerenciamento de dados
    exportDataOptionBtn.addEventListener('click', () => {
      // Coleta todos os dados relevantes do aplicativo para exportação
      const data = {
        items,
        folders,
        savedTags,
        theme,
        currentLanguage
      };
      // Cria um objeto Blob (Binary Large Object) com os dados JSON formatados para legibilidade
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob); // Cria uma URL temporária para o Blob
      const a = document.createElement('a'); // Cria um elemento <a> (link) no DOM
      a.href = url; // Define o href do link para a URL do Blob
      a.download = 'liquid-glass-data.json'; // Define o nome do arquivo que será baixado
      a.click(); // Simula um clique no link para iniciar o download
      URL.revokeObjectURL(url); // Libera o objeto URL para economizar memória
      manageDataModal.classList.add('hidden'); // Oculta o modal de gerenciamento após a exportação
    });

    // Event listener para o input de arquivo de importação (acionado quando um arquivo é selecionado)
    importFileModalInput.addEventListener('change', (e) => {
      const file = e.target.files[0]; // Obtém o primeiro arquivo selecionado
      if (file) { // Se um arquivo foi selecionado
        const reader = new FileReader(); // Cria um objeto FileReader para ler o conteúdo do arquivo
        reader.onload = async (event) => { // Callback quando a leitura do arquivo estiver completa
          try {
            const data = JSON.parse(event.target.result); // Tenta parsear o conteúdo do arquivo como JSON
            importedDataCache = data; // Armazena os dados importados em um cache temporário
            
            // Define todos os checkboxes de importação como marcados por padrão para conveniência do usuário
            importItemsCheckbox.checked = true;
            importFoldersCheckbox.checked = true;
            importTagsCheckbox.checked = true;
            importThemeCheckbox.checked = true;
            importLanguageCheckbox.checked = true;

            manageDataModal.classList.add('hidden'); // Oculta o modal de gerenciamento de dados
            importSelectionModal.classList.remove('hidden'); // Mostra o modal de seleção de opções de importação

          } catch (err) {
            console.error("Error parsing JSON file:", err); // Loga o erro se o arquivo não for um JSON válido
            showCustomModal(window.translations[currentLanguage]['invalidJsonFile'], window.translations[currentLanguage]['okBtn']); // Alerta o usuário sobre o arquivo inválido
            importFileModalInput.value = ''; // Limpa o input de arquivo para permitir nova seleção
          }
        };
        reader.readAsText(file); // Inicia a leitura do arquivo como texto
      }
    });

    // Event listener para o botão "Confirmar Importação" no modal de seleção de importação
    confirmImportSelectionBtn.addEventListener('click', async () => {
      if (!importedDataCache) { // Verifica se há dados no cache para importar
          showCustomModal("Nenhum dado para importar. Por favor, selecione um arquivo JSON primeiro.", window.translations[currentLanguage]['okBtn']);
          return; // Sai da função se não houver dados
      }

      showLoadingMessage(window.translations[currentLanguage]['importingData']); // Exibe mensagem de "Importando dados..."
      
      // Obtém o estado de cada checkbox para decidir quais categorias de dados importar
      const importItems = importItemsCheckbox.checked;
      const importFolders = importFoldersCheckbox.checked;
      const importTags = importTagsCheckbox.checked;
      const importTheme = importThemeCheckbox.checked;
      const importLanguage = importLanguageCheckbox.checked;

      // Exibe um modal de confirmação para o usuário antes de prosseguir com a sobrescrita/mesclagem
      showConfirmModal(window.translations[currentLanguage]['confirmImport'], async () => {
          // Lógica de Importação para Itens:
          if (importItems && importedDataCache.items && Array.isArray(importedDataCache.items)) {
              const newItems = [];
              for (const ni of importedDataCache.items) {
                  // Verifica se o item a ser importado já existe localmente (pela URL)
                  if (!items.some(i => i.url === ni.url)) {
                      // Garante que as propriedades 'rating' e 'accessHistory' existam para itens importados
                      ni.rating = ni.rating !== undefined ? ni.rating : 0;
                      ni.accessHistory = ni.accessHistory || [];
                      // Tenta buscar metadados para itens importados se estiverem faltando ou forem placeholders
                      if (!ni.metadata || !ni.metadata.title || (ni.metadata.image && ni.metadata.image.includes('placehold.co'))) {
                          ni.metadata = await fetchMetadata(ni.url);
                      }
                      newItems.push(ni); // Adiciona o item à lista de novos itens
                  }
              }
              items = [...items, ...newItems]; // Mescla: adiciona novos itens, mantendo os existentes únicos
          }

          // Lógica de Importação para Pastas:
          if (importFolders && importedDataCache.folders && Array.isArray(importedDataCache.folders)) {
              // Filtra pastas importadas para adicionar apenas as que não existem localmente
              const newFolders = importedDataCache.folders.filter(nf => !folders.some(f => f.name === nf.name));
              folders = [...folders, ...newFolders]; // Mescla: adiciona novas pastas
          }

          // Lógica de Importação para Tags Salvas:
          if (importTags && importedDataCache.savedTags && Array.isArray(importedDataCache.savedTags)) {
              // Filtra tags importadas para adicionar apenas as que não existem localmente
              const newSavedTags = importedDataCache.savedTags.filter(nst => !savedTags.includes(nst));
              savedTags = [...savedTags, ...newSavedTags]; // Mescla: adiciona novas tags
          }

          // Lógica de Importação para Tema:
          if (importTheme && importedDataCache.theme) {
              theme = importedDataCache.theme; // Sobrescreve o tema atual
          }

          // Lógica de Importação para Idioma:
          if (importLanguage && importedDataCache.currentLanguage) {
              currentLanguage = importedDataCache.currentLanguage; // Sobrescreve o idioma atual
          }

          // Salva todos os dados atualizados (itens, pastas, tags, tema, idioma) no localStorage
          localStorage.setItem('items', JSON.stringify(items));
          localStorage.setItem('folders', JSON.stringify(folders));
          localStorage.setItem('savedTags', JSON.stringify(savedTags));
          localStorage.setItem('theme', theme); 
          localStorage.setItem('language', currentLanguage);

          // Atualiza toda a interface do usuário para refletir os dados importados
          applyTheme();
          updateFolderSelects();
          updateSavedTagsList();
          applyLanguage(currentLanguage);
          renderItems();
          updateDashboard(); // Atualiza o dashboard com os novos dados
          
          importSelectionModal.classList.add('hidden'); // Oculta o modal de seleção de importação
          importFileModalInput.value = ''; // Limpa o input do arquivo
          importedDataCache = null; // Limpa o cache de dados importados
          showLoadingMessage(window.translations[currentLanguage]['importSuccess'], 2000); // Exibe mensagem de sucesso por 2 segundos

      }, () => { // Callback para quando o usuário clica em "Cancelar" no modal de confirmação
          hideLoadingMessage(); // Oculta qualquer mensagem de carregamento
          importSelectionModal.classList.add('hidden'); // Oculta o modal de seleção de importação
          importFileModalInput.value = ''; // Limpa o input do arquivo
          importedDataCache = null; // Limpa o cache de dados importados
          showCustomModal(window.translations[currentLanguage]['importCanceled'], window.translations[currentLanguage]['okBtn']); // Alerta o usuário que a importação foi cancelada
      }, window.translations[currentLanguage]['yesBtn'], window.translations[currentLanguage]['noBtn']); // Textos dos botões "Sim" e "Não"
    });

    // Função genérica para exibir um modal customizado (substitui o 'alert' padrão do navegador)
    function showCustomModal(message, okBtnText = 'OK') {
        const modal = document.createElement('div'); // Cria um novo elemento div para o modal
        modal.classList.add('modal-overlay'); // Adiciona a classe de overlay para estilização
        modal.innerHTML = `
            <div class="modal-content">
                <p>${message}</p>
                <div class="modal-actions">
                    <button class="modal-btn confirm" id="modal-ok-btn">${okBtnText}</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal); // Adiciona o modal ao corpo do documento

        // Adiciona um event listener ao botão "OK" do modal para fechá-lo
        document.getElementById('modal-ok-btn').addEventListener('click', () => {
            modal.remove(); // Remove o modal do DOM
        });
    }

    // Função genérica para exibir um modal de confirmação (substitui o 'confirm' padrão do navegador)
    function showConfirmModal(message, onConfirm, onCancel, yesBtnText = 'Sim', noBtnText = 'Não') {
        const modal = document.createElement('div'); // Cria um novo elemento div para o modal
        modal.classList.add('modal-overlay'); // Adiciona a classe de overlay
        modal.innerHTML = `
            <div class="modal-content">
                <p>${message}</p>
                <div class="modal-actions">
                    <button class="modal-btn confirm" id="confirm-action-btn">${yesBtnText}</button>
                    <button class="modal-btn cancel" id="cancel-action-btn">${noBtnText}</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal); // Adiciona o modal ao corpo do documento

        // Adiciona um event listener ao botão de confirmação
        document.getElementById('confirm-action-btn').addEventListener('click', () => {
            modal.remove(); // Remove o modal
            onConfirm(); // Executa a função de confirmação passada como argumento
        });

        // Adiciona um event listener ao botão de cancelamento
        document.getElementById('cancel-action-btn').addEventListener('click', () => {
            modal.remove(); // Remove o modal
            if (onCancel) onCancel(); // Executa a função de cancelamento, se fornecida
        });
    }

    // Função para mostrar a mensagem de carregamento na tela
    function showLoadingMessage(message, duration = 0) {
        loadingMessage.textContent = message; // Define o texto da mensagem de carregamento
        loadingMessage.style.display = 'block'; // Torna a mensagem visível
        if (duration > 0) { // Se uma duração for especificada
            setTimeout(() => {
                hideLoadingMessage(); // Oculta a mensagem após a duração
            }, duration);
        }
    }

    // Função para ocultar a mensagem de carregamento da tela
    function hideLoadingMessage() {
        loadingMessage.style.display = 'none'; // Oculta a mensagem
    }

    // Event listener para a mudança de seleção no dropdown de idioma
    languageSelect.addEventListener('change', (e) => {
      applyLanguage(e.target.value); // Chama a função para aplicar o novo idioma
    });

    // Define o valor inicial do select de idioma com o idioma atualmente salvo
    languageSelect.value = currentLanguage;

    // Adiciona event listeners para os botões de limpar input (o "X" dentro dos campos)
    document.querySelectorAll('.clear-input-btn').forEach(button => {
        button.addEventListener('click', (e) => {
            const targetInputId = e.target.dataset.targetInput; // Obtém o ID do input associado ao botão
            const targetInput = document.getElementById(targetInputId); // Encontra o elemento input
            if (targetInput) {
                targetInput.value = ''; // Limpa o valor do input
                if (targetInputId === 'item-url') {
                    updatePreview(''); // Se for o input de URL, limpa a pré-visualização
                }
                if (targetInputId.startsWith('search-')) {
                    searchItems(); // Se for um input de busca, re-executa a busca para refletir a mudança
                }
            }
        });
    });

    // **Inicialização do Aplicativo:**
    // Tudo dentro deste bloco é executado quando o DOM estiver completamente carregado.
    document.addEventListener('DOMContentLoaded', () => {
        applyTheme(); // Aplica o tema salvo ou padrão
        updateFolderSelects(); // Carrega e renderiza as pastas
        updateSavedTagsList(); // Carrega e renderiza as tags
        applyLanguage(currentLanguage); // Aplica o idioma salvo ou padrão (importante para traduções iniciais)
        renderItems(); // Renderiza a lista inicial de itens
        updateDashboard(); // Renderiza os dados do dashboard
        showTab('dashboard-tab'); // Define a aba "Dashboard" como a aba inicial visível
    });
  </script>
</body>
</html>
